


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>discretize.mixins.mpl_mod &mdash; discretize 0.7.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-rendered-html.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/logo-block.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 

<meta name="description" content="Simulation and Parameter Estimation in Geophysics">
<meta name="author" content="SimPEG Developers">
<meta name="keywords" content="python, geophysics, inversion, electromagnetics, magnetotellurics, magnetics, gravity, DC, flow inverse problems, open source, finite volume">


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45185336-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> discretize
          

          
          </a>

          
            
            
              <div class="version">
                0.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../content/big_picture.html">Why discretize?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/additional_resources.html">Additional Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/mesh_generation/index.html">Mesh Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/operators/index.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/inner_products/index.html">Inner Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/pde/index.html">Solving PDEs</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../content/finite_volume.html">Finite Volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/inner_products.html">Inner Products</a></li>
</ul>
<p class="caption"><span class="caption-text">Meta Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">
            
                Getting connected
            
            </span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://simpeg.xyz"><i class="fa fa-external-link-square fa-fw"></i> SimPEG</a></li>
            
                <li class="toctree-l1"><a href="http://slack.simpeg.xyz"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/simpeg/discretize"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">discretize</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>discretize.mixins.mpl_mod</li>
    
    

    <li class="wy-breadcrumbs-aside">
        
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for discretize.mixins.mpl_mod</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">discretize.utils</span> <span class="kn">import</span> <span class="n">mkvc</span><span class="p">,</span> <span class="n">ndgrid</span>
<span class="kn">from</span> <span class="nn">discretize.utils.code_utils</span> <span class="kn">import</span> <span class="n">deprecate_method</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Slider</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PolyCollection</span><span class="p">,</span> <span class="n">LineCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc_params</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Line3DCollection</span>
<span class="kn">import</span> <span class="nn">discretize</span>


<div class="viewcode-block" id="InterfaceMPL"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.InterfaceMPL.html#discretize.mixins.mpl_mod.InterfaceMPL">[docs]</a><span class="k">class</span> <span class="nc">InterfaceMPL</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class is used for simple ``discretize`` mesh plotting using matplotlib.</span>

<span class="sd">    This interface adds three methods to the meshes. ``plot_grid`` will plot the</span>
<span class="sd">    grid points of each mesh in 2D and 3D. ``plot_image`` for 2D image ploting of</span>
<span class="sd">    models. and ``plot_slice`` for plotting a 2D slice through a 3D mesh.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="InterfaceMPL.plot_grid"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.InterfaceMPL.html#discretize.mixins.mpl_mod.InterfaceMPL.plot_grid">[docs]</a>    <span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">show_it</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot the nodal, cell-centered and staggered grids.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax : matplotlib.axes.Axes or None, optional</span>
<span class="sd">            The axes to draw on. None produces a new Axes.</span>
<span class="sd">        nodes, faces, centers, edges, lines : bool, optional</span>
<span class="sd">            Whether to plot the corresponding item</span>
<span class="sd">        show_it : bool, optional</span>
<span class="sd">            whether to call plt.show()</span>
<span class="sd">        color : Color or str, optional</span>
<span class="sd">            If lines=True, the color of the lines, defaults to first color.</span>
<span class="sd">        linewidth : float, optional</span>
<span class="sd">            If lines=True, the linewidth for the lines.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.axes.Axes</span>
<span class="sd">            Axes handle for the plot</span>

<span class="sd">        Other Parameters</span>
<span class="sd">        ----------------</span>
<span class="sd">        edges_x, edges_y, edges_z, faces_x, faces_y, faces_z : bool, optional</span>
<span class="sd">            When plotting a ``TreeMesh``, these are also options to plot the</span>
<span class="sd">            individual component items.</span>
<span class="sd">        cell_line : bool, optional</span>
<span class="sd">            When plotting a ``TreeMesh``, you can also plot a line through the</span>
<span class="sd">            cell centers in order.</span>
<span class="sd">        slice : {&#39;both&#39;, &#39;theta&#39;, &#39;z&#39;}</span>
<span class="sd">            When plotting a ``CylindricalMesh``, which dimension to slice over.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Excess arguments are passed on to `plot`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Plotting a 2D TensorMesh grid</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; h1 = np.linspace(.1, .5, 3)</span>
<span class="sd">        &gt;&gt;&gt; h2 = np.linspace(.1, .5, 5)</span>
<span class="sd">        &gt;&gt;&gt; mesh = discretize.TensorMesh([h1, h2])</span>
<span class="sd">        &gt;&gt;&gt; mesh.plot_grid(nodes=True, faces=True, centers=True, lines=True)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Plotting a 3D TensorMesh grid</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; h1 = np.linspace(.1, .5, 3)</span>
<span class="sd">        &gt;&gt;&gt; h2 = np.linspace(.1, .5, 5)</span>
<span class="sd">        &gt;&gt;&gt; h3 = np.linspace(.1, .5, 3)</span>
<span class="sd">        &gt;&gt;&gt; mesh = discretize.TensorMesh([h1, h2, h3])</span>
<span class="sd">        &gt;&gt;&gt; mesh.plot_grid(nodes=True, faces=True, centers=True, lines=True)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Plotting a 2D CurvilinearMesh</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; X, Y = discretize.utils.exampleLrmGrid([10, 10], &#39;rotate&#39;)</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.CurvilinearMesh([X, Y])</span>
<span class="sd">        &gt;&gt;&gt; M.plot_grid()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Plotting a 3D CurvilinearMesh</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; X, Y, Z = discretize.utils.exampleLrmGrid([5, 5, 5], &#39;rotate&#39;)</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.CurvilinearMesh([X, Y, Z])</span>
<span class="sd">        &gt;&gt;&gt; M.plot_grid()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Plotting a 2D TreeMesh</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.TreeMesh([32, 32])</span>
<span class="sd">        &gt;&gt;&gt; M.insert_cells([[0.25, 0.25]], [4])</span>
<span class="sd">        &gt;&gt;&gt; M.plot_grid()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Plotting a 3D TreeMesh</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.TreeMesh([32, 32, 32])</span>
<span class="sd">        &gt;&gt;&gt; M.insert_cells([[0.3, 0.75, 0.22]], [4])</span>
<span class="sd">        &gt;&gt;&gt; M.plot_grid()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">plotters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_grid_tree</span><span class="p">,</span>
            <span class="s2">&quot;tensor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_grid_tensor</span><span class="p">,</span>
            <span class="s2">&quot;curv&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_grid_curv</span><span class="p">,</span>
            <span class="s2">&quot;cyl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_grid_cyl</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">plotters</span><span class="p">[</span><span class="n">mesh_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Mesh type `</span><span class="si">{}</span><span class="s2">` does not have a plot_grid implementation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;showIt&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">show_it</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;showIt&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;showIt has been deprecated, please use show_it&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax_test</span> <span class="o">=</span> <span class="n">ax</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax_test</span> <span class="o">=</span> <span class="p">(</span><span class="n">ax</span><span class="p">,)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax_test</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ax must be an matplotlib.axes.Axes&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mesh_type</span> <span class="o">!=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
            <span class="n">axOpts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="o">**</span><span class="n">axOpts</span><span class="p">)</span>

        <span class="n">rcParams</span> <span class="o">=</span> <span class="n">rc_params</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.color&quot;</span><span class="p">])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;lines.linewidth&quot;</span><span class="p">])</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
            <span class="n">faces</span><span class="o">=</span><span class="n">faces</span><span class="p">,</span>
            <span class="n">centers</span><span class="o">=</span><span class="n">centers</span><span class="p">,</span>
            <span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">,</span>
            <span class="n">lines</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show_it</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="InterfaceMPL.plot_image"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.InterfaceMPL.html#discretize.mixins.mpl_mod.InterfaceMPL.plot_image">[docs]</a>    <span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_it</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots fields on the given mesh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : numpy.ndarray</span>
<span class="sd">            values to plot</span>
<span class="sd">        v_type : {&#39;CC&#39;,&#39;CCV&#39;, &#39;N&#39;, &#39;F&#39;, &#39;Fx&#39;, &#39;Fy&#39;, &#39;Fz&#39;, &#39;E&#39;, &#39;Ex&#39;, &#39;Ey&#39;, &#39;Ez&#39;}</span>
<span class="sd">            Where the values of v are defined.</span>
<span class="sd">        view : {&#39;real&#39;, &#39;imag&#39;, &#39;abs&#39;, &#39;vec&#39;}</span>
<span class="sd">            How to view the array.</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            The axes to draw on. None produces a new Axes.</span>
<span class="sd">        clim : tuple of float, optional</span>
<span class="sd">            length 2 tuple of (vmin, vmax) for the color limits</span>
<span class="sd">        range_x, range_y : tuple of float, optional</span>
<span class="sd">            length 2 tuple of (min, max) for the bounds of the plot axes.</span>
<span class="sd">        pcolor_opts : dict, optional</span>
<span class="sd">            Arguments passed on to ``pcolormesh``</span>
<span class="sd">        grid : bool, optional</span>
<span class="sd">            Whether to plot the edges of the mesh cells.</span>
<span class="sd">        grid_opts : dict, optional</span>
<span class="sd">            If ``grid`` is true, arguments passed on to ``plot`` for grid</span>
<span class="sd">        sample_grid : tuple of numpy.ndarray, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, mesh cell widths (hx, hy) to interpolate onto for vector plotting</span>
<span class="sd">        stream_opts : dict, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, arguments passed on to ``streamplot``</span>
<span class="sd">        stream_thickness : float, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, linewidth for ``streamplot``</span>
<span class="sd">        stream_threshold : float, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, only plots vectors with magnitude above this threshold</span>
<span class="sd">        show_it : bool, optional</span>
<span class="sd">            Whether to call plt.show()</span>
<span class="sd">        numbering : bool, optional</span>
<span class="sd">            For 3D TensorMesh only, show the numbering of the slices</span>
<span class="sd">        annotation_color : Color or str, optional</span>
<span class="sd">            For 3D TensorMesh only, color of the annotation</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        2D ``TensorMesh`` plotting</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.TensorMesh([20, 20])</span>
<span class="sd">        &gt;&gt;&gt; v = np.sin(M.gridCC[:, 0]*2*np.pi)*np.sin(M.gridCC[:, 1]*2*np.pi)</span>
<span class="sd">        &gt;&gt;&gt; M.plot_image(v)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        3D ``TensorMesh`` plotting</span>

<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.TensorMesh([20, 20, 20])</span>
<span class="sd">        &gt;&gt;&gt; v = np.sin(M.gridCC[:, 0]*2*np.pi)*np.sin(M.gridCC[:, 1]*2*np.pi)*np.sin(M.gridCC[:, 2]*2*np.pi)</span>
<span class="sd">        &gt;&gt;&gt; M.plot_image(v, annotation_color=&#39;k&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">plotters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_image_tree</span><span class="p">,</span>
            <span class="s2">&quot;tensor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_image_tensor</span><span class="p">,</span>
            <span class="s2">&quot;curv&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_image_curv</span><span class="p">,</span>
            <span class="s2">&quot;cyl&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_image_cyl</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">plotters</span><span class="p">[</span><span class="n">mesh_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Mesh type `</span><span class="si">{}</span><span class="s2">` does not have a plot_image implementation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;pcolorOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;pcolorOpts&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;pcolorOpts has been deprecated, please use pcolor_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;streamOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">stream_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;streamOpts&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;streamOpts has been deprecated, please use stream_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;gridOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">grid_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;gridOpts&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;gridOpts has been deprecated, please use grid_opts&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;showIt&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">show_it</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;showIt&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;showIt has been deprecated, please use show_it&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vType&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">v_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vType&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;vType has been deprecated, please use v_type&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>

        <span class="c1"># Some Error checking and common defaults</span>
        <span class="k">if</span> <span class="n">pcolor_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">stream_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">grid_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                <span class="n">grid_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">v_typeOptsCC</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">]</span>
        <span class="n">v_typeOptsV</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CCv&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]</span>
        <span class="n">v_typeOpts</span> <span class="o">=</span> <span class="n">v_typeOptsCC</span> <span class="o">+</span> <span class="n">v_typeOptsV</span>
        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v_typeOptsV</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;v_type must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;] when view=&#39;vec&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v_typeOptsV</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v_typeOpts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;v_type must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v_typeOpts</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">viewOpts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">,</span> <span class="s2">&quot;vec&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">viewOpts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;view must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">viewOpts</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">complex</span> <span class="ow">and</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can not plot a complex vector.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ax must be an Axes!&quot;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
        <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcolor_opts</span><span class="p">[</span><span class="s2">&quot;vmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pcolor_opts</span><span class="p">[</span><span class="s2">&quot;vmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">v_type</span><span class="o">=</span><span class="n">v_type</span><span class="p">,</span>
            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">range_x</span><span class="o">=</span><span class="n">range_x</span><span class="p">,</span>
            <span class="n">range_y</span><span class="o">=</span><span class="n">range_y</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
            <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
            <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
            <span class="n">sample_grid</span><span class="o">=</span><span class="n">sample_grid</span><span class="p">,</span>
            <span class="n">stream_opts</span><span class="o">=</span><span class="n">stream_opts</span><span class="p">,</span>
            <span class="n">stream_threshold</span><span class="o">=</span><span class="n">stream_threshold</span><span class="p">,</span>
            <span class="n">stream_thickness</span><span class="o">=</span><span class="n">stream_thickness</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show_it</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="InterfaceMPL.plot_slice"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.InterfaceMPL.html#discretize.mixins.mpl_mod.InterfaceMPL.plot_slice">[docs]</a>    <span class="k">def</span> <span class="nf">plot_slice</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">normal</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span>
        <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">slice_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">show_it</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots slice of fields on the given 3D mesh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v : numpy.ndarray</span>
<span class="sd">            values to plot</span>
<span class="sd">        v_type : {&#39;CC&#39;,&#39;CCV&#39;, &#39;N&#39;, &#39;F&#39;, &#39;Fx&#39;, &#39;Fy&#39;, &#39;Fz&#39;, &#39;E&#39;, &#39;Ex&#39;, &#39;Ey&#39;, &#39;Ez&#39;}, or tuple of these options</span>
<span class="sd">            Where the values of v are defined.</span>
<span class="sd">        normal : {&#39;Z&#39;, &#39;X&#39;, &#39;Y&#39;}</span>
<span class="sd">            Normal direction of slicing plane.</span>
<span class="sd">        ind : None, optional</span>
<span class="sd">            index along dimension of slice. Defaults to the center index.</span>
<span class="sd">        slice_loc : None, optional</span>
<span class="sd">            Value along dimension of slice. Defaults to the center of the mesh.</span>
<span class="sd">        view : {&#39;real&#39;, &#39;imag&#39;, &#39;abs&#39;, &#39;vec&#39;}</span>
<span class="sd">            How to view the array.</span>
<span class="sd">        ax : matplotlib.axes.Axes, optional</span>
<span class="sd">            The axes to draw on. None produces a new Axes. Must be None if ``v_type`` is a tuple.</span>
<span class="sd">        clim : tuple of float, optional</span>
<span class="sd">            length 2 tuple of (vmin, vmax) for the color limits</span>
<span class="sd">        range_x, range_y : tuple of float, optional</span>
<span class="sd">            length 2 tuple of (min, max) for the bounds of the plot axes.</span>
<span class="sd">        pcolor_opts : dict, optional</span>
<span class="sd">            Arguments passed on to ``pcolormesh``</span>
<span class="sd">        grid : bool, optional</span>
<span class="sd">            Whether to plot the edges of the mesh cells.</span>
<span class="sd">        grid_opts : dict, optional</span>
<span class="sd">            If ``grid`` is true, arguments passed on to ``plot`` for the edges</span>
<span class="sd">        sample_grid : tuple of numpy.ndarray, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, mesh cell widths (hx, hy) to interpolate onto for vector plotting</span>
<span class="sd">        stream_opts : dict, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, arguments passed on to ``streamplot``</span>
<span class="sd">        stream_thickness : float, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, linewidth for ``streamplot``</span>
<span class="sd">        stream_threshold : float, optional</span>
<span class="sd">            If ``view`` == &#39;vec&#39;, only plots vectors with magnitude above this threshold</span>
<span class="sd">        show_it : bool, optional</span>
<span class="sd">            Whether to call plt.show()</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Plot a slice of a 3D `TensorMesh` solution to a Laplace&#39;s equaiton.</span>

<span class="sd">        First build the mesh:</span>

<span class="sd">        &gt;&gt;&gt; from matplotlib import pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import discretize</span>
<span class="sd">        &gt;&gt;&gt; from pymatsolver import Solver</span>
<span class="sd">        &gt;&gt;&gt; hx = [(5, 2, -1.3), (2, 4), (5, 2, 1.3)]</span>
<span class="sd">        &gt;&gt;&gt; hy = [(2, 2, -1.3), (2, 6), (2, 2, 1.3)]</span>
<span class="sd">        &gt;&gt;&gt; hz = [(2, 2, -1.3), (2, 6), (2, 2, 1.3)]</span>
<span class="sd">        &gt;&gt;&gt; M = discretize.TensorMesh([hx, hy, hz])</span>

<span class="sd">        then build the necessary parts of the PDE:</span>

<span class="sd">        &gt;&gt;&gt; q = np.zeros(M.vnC)</span>
<span class="sd">        &gt;&gt;&gt; q[[4, 4], [4, 4], [2, 6]]=[-1, 1]</span>
<span class="sd">        &gt;&gt;&gt; q = discretize.utils.mkvc(q)</span>
<span class="sd">        &gt;&gt;&gt; A = M.face_divergence * M.cell_gradient</span>
<span class="sd">        &gt;&gt;&gt; b = Solver(A) * (q)</span>

<span class="sd">        and finaly, plot the vector values of the result, which are defined on faces</span>

<span class="sd">        &gt;&gt;&gt; M.plot_slice(M.cell_gradient*b, &#39;F&#39;, view=&#39;vec&#39;, grid=True, pcolor_opts={&#39;alpha&#39;:0.8})</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        We can use the `slice_loc kwarg to tell `plot_slice` where to slice the mesh.</span>
<span class="sd">        Let&#39;s create a mesh with a random model and plot slice of it. The `slice_loc`</span>
<span class="sd">        kwarg automatically determines the indices for slicing the mesh along a plane with</span>
<span class="sd">        the given normal.</span>

<span class="sd">        &gt;&gt;&gt; M = discretize.TensorMesh([32, 32, 32])</span>
<span class="sd">        &gt;&gt;&gt; v = discretize.utils.random_model(M.vnC, seed=789).reshape(-1, order=&#39;F&#39;)</span>
<span class="sd">        &gt;&gt;&gt; x_slice, y_slice, z_slice = 0.75, 0.25, 0.9</span>
<span class="sd">        &gt;&gt;&gt; plt.figure(figsize=(7.5, 3))</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(131)</span>
<span class="sd">        &gt;&gt;&gt; M.plot_slice(v, normal=&#39;X&#39;, slice_loc=x_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(132)</span>
<span class="sd">        &gt;&gt;&gt; M.plot_slice(v, normal=&#39;Y&#39;, slice_loc=y_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(133)</span>
<span class="sd">        &gt;&gt;&gt; M.plot_slice(v, normal=&#39;Z&#39;, slice_loc=z_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        This also works for `TreeMesh`. We create a mesh here that is refined within three</span>
<span class="sd">        boxes, along with a base level of refinement.</span>

<span class="sd">        &gt;&gt;&gt; TM = discretize.TreeMesh([32, 32, 32])</span>
<span class="sd">        &gt;&gt;&gt; TM.refine(3, finalize=False)</span>
<span class="sd">        &gt;&gt;&gt; BSW = [[0.25, 0.25, 0.25], [0.15, 0.15, 0.15], [0.1, 0.1, 0.1]]</span>
<span class="sd">        &gt;&gt;&gt; TNE = [[0.75, 0.75, 0.75], [0.85, 0.85, 0.85], [0.9, 0.9, 0.9]]</span>
<span class="sd">        &gt;&gt;&gt; levels = [6, 5, 4]</span>
<span class="sd">        &gt;&gt;&gt; TM.refine_box(BSW, TNE, levels)</span>
<span class="sd">        &gt;&gt;&gt; v_TM = discretize.utils.volume_average(M, TM, v)</span>
<span class="sd">        &gt;&gt;&gt; plt.figure(figsize=(7.5, 3))</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(131)</span>
<span class="sd">        &gt;&gt;&gt; TM.plot_slice(v_TM, normal=&#39;X&#39;, slice_loc=x_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(132)</span>
<span class="sd">        &gt;&gt;&gt; TM.plot_slice(v_TM, normal=&#39;Y&#39;, slice_loc=y_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; ax = plt.subplot(133)</span>
<span class="sd">        &gt;&gt;&gt; TM.plot_slice(v_TM, normal=&#39;Z&#39;, slice_loc=z_slice, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; plt.tight_layout()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">plotters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_slice_tree</span><span class="p">,</span>
            <span class="s2">&quot;tensor&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_slice_tensor</span><span class="p">,</span>
            <span class="c1"># &#39;curv&#39;: self.__plot_slice_curv,</span>
            <span class="c1"># &#39;cyl&#39;: self.__plot_slice_cyl,</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotter</span> <span class="o">=</span> <span class="n">plotters</span><span class="p">[</span><span class="n">mesh_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Mesh type `</span><span class="si">{}</span><span class="s2">` does not have a plot_slice implementation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;pcolorOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pcolorOpts&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;pcolorOpts has been deprecated, please use pcolor_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;streamOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">stream_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;streamOpts&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;streamOpts has been deprecated, please use stream_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;gridOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">grid_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;gridOpts&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;gridOpts has been deprecated, please use grid_opts&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;showIt&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">show_it</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;showIt&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;showIt has been deprecated, please use show_it&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vType&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">v_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;vType&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;vType has been deprecated, please use v_type&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">pcolor_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">stream_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stream_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">grid_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                <span class="n">grid_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grid_opts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v_type</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot specify an axis to plot on with this function.&quot;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_type</span><span class="p">))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v_typeI</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_type</span><span class="p">,</span> <span class="n">axs</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span>
                        <span class="n">v</span><span class="p">,</span>
                        <span class="n">v_type</span><span class="o">=</span><span class="n">v_typeI</span><span class="p">,</span>
                        <span class="n">normal</span><span class="o">=</span><span class="n">normal</span><span class="p">,</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span>
                        <span class="n">slice_loc</span><span class="o">=</span><span class="n">slice_loc</span><span class="p">,</span>
                        <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
                        <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                        <span class="n">clim</span><span class="o">=</span><span class="n">clim</span><span class="p">,</span>
                        <span class="n">show_it</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
                        <span class="n">stream_opts</span><span class="o">=</span><span class="n">stream_opts</span><span class="p">,</span>
                        <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
                        <span class="n">stream_threshold</span><span class="o">=</span><span class="n">stream_threshold</span><span class="p">,</span>
                        <span class="n">stream_thickness</span><span class="o">=</span><span class="n">stream_thickness</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">]</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="n">viewOpts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">,</span> <span class="s2">&quot;vec&quot;</span><span class="p">]</span>
        <span class="n">normalOpts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">]</span>
        <span class="n">v_typeOpts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;CC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CCv&quot;</span><span class="p">,</span>
            <span class="s2">&quot;N&quot;</span><span class="p">,</span>
            <span class="s2">&quot;F&quot;</span><span class="p">,</span>
            <span class="s2">&quot;E&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Fx&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Fy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Fz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;E&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ey&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ez&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Some user error checking</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v_typeOpts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;v_type must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v_typeOpts</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Must be a 3D mesh. Use plotImage.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">viewOpts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;view must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">viewOpts</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">normal</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normalOpts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;normal must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">normalOpts</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;grid must be a boolean&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">complex</span> <span class="ow">and</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Can not plot a complex vector.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Must be a 3D mesh. Use plotImage.&quot;</span><span class="p">)</span>

        <span class="c1"># slice_loc errors</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">slice_loc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;Both ind and slice_loc are defined. Behavior undefined.&quot;</span><span class="p">)</span>
        <span class="c1"># slice_loc implement</span>
        <span class="k">if</span> <span class="n">slice_loc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_centers_x</span> <span class="o">-</span> <span class="n">slice_loc</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_centers_y</span> <span class="o">-</span> <span class="n">slice_loc</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_centers_z</span> <span class="o">-</span> <span class="n">slice_loc</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ax must be an matplotlib.axes.Axes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pcolor_opts</span><span class="p">[</span><span class="s2">&quot;vmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pcolor_opts</span><span class="p">[</span><span class="s2">&quot;vmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">v_type</span><span class="o">=</span><span class="n">v_type</span><span class="p">,</span>
            <span class="n">normal</span><span class="o">=</span><span class="n">normal</span><span class="p">,</span>
            <span class="n">ind</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span>
            <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
            <span class="n">stream_opts</span><span class="o">=</span><span class="n">stream_opts</span><span class="p">,</span>
            <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
            <span class="n">range_x</span><span class="o">=</span><span class="n">range_x</span><span class="p">,</span>
            <span class="n">range_y</span><span class="o">=</span><span class="n">range_y</span><span class="p">,</span>
            <span class="n">sample_grid</span><span class="o">=</span><span class="n">sample_grid</span><span class="p">,</span>
            <span class="n">stream_threshold</span><span class="o">=</span><span class="n">stream_threshold</span><span class="p">,</span>
            <span class="n">stream_thickness</span><span class="o">=</span><span class="n">stream_thickness</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show_it</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="InterfaceMPL.plot_3d_slicer"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.InterfaceMPL.html#discretize.mixins.mpl_mod.InterfaceMPL.plot_3d_slicer">[docs]</a>    <span class="k">def</span> <span class="nf">plot_3d_slicer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">yslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot slices of a 3D volume, interactively (scroll wheel).</span>

<span class="sd">        If called from a notebook, make sure to set</span>

<span class="sd">            %matplotlib notebook</span>

<span class="sd">        See the class `discretize.View.Slicer` for more information.</span>

<span class="sd">        It returns nothing. However, if you need the different figure handles</span>
<span class="sd">        you can get it via</span>

<span class="sd">          `fig = plt.gcf()`</span>

<span class="sd">        and subsequently its children via</span>

<span class="sd">          `fig.get_children()`</span>

<span class="sd">        and recursively deeper, e.g.,</span>

<span class="sd">          `fig.get_children()[0].get_children()`.</span>

<span class="sd">        One can also provide an existing figure instance, which can be useful</span>
<span class="sd">        for interactive widgets in Notebooks. The provided figure is cleared</span>
<span class="sd">        first.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mesh_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meshType</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mesh_type</span> <span class="o">!=</span> <span class="s2">&quot;tensor&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;plot_3d_slicer has only been implemented for a TensorMesh&quot;</span>
            <span class="p">)</span>
        <span class="c1"># Initiate figure</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;pcolorOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pcolorOpts&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;pcolorOpts has been deprecated, please use pcolor_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Populate figure</span>
        <span class="n">tracker</span> <span class="o">=</span> <span class="n">Slicer</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">v</span><span class="p">,</span>
            <span class="n">xslice</span><span class="p">,</span>
            <span class="n">yslice</span><span class="p">,</span>
            <span class="n">zslice</span><span class="p">,</span>
            <span class="n">v_type</span><span class="p">,</span>
            <span class="n">view</span><span class="p">,</span>
            <span class="n">axis</span><span class="p">,</span>
            <span class="n">transparent</span><span class="p">,</span>
            <span class="n">clim</span><span class="p">,</span>
            <span class="n">xlim</span><span class="p">,</span>
            <span class="n">ylim</span><span class="p">,</span>
            <span class="n">zlim</span><span class="p">,</span>
            <span class="n">aspect</span><span class="p">,</span>
            <span class="n">grid</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Connect figure to scrolling</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s2">&quot;scroll_event&quot;</span><span class="p">,</span> <span class="n">tracker</span><span class="o">.</span><span class="n">onscroll</span><span class="p">)</span>

        <span class="c1"># Show figure</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="c1"># TensorMesh plotting</span>
    <span class="k">def</span> <span class="nf">__plot_grid_tensor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nN</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nN</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">faces</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Plot the grid lines</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">NN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
                <span class="n">nCx</span><span class="p">,</span> <span class="n">nCy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span>
                <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">nCx</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">nCx</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="n">nCy</span><span class="p">]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="n">nCy</span><span class="p">]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">]</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y1</span><span class="p">,</span> <span class="n">Y2</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x2&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">faces</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">zs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEz</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="c1"># Plot the grid lines</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">nCx</span><span class="p">,</span> <span class="n">nCy</span><span class="p">,</span> <span class="n">nCz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span>
                <span class="n">NN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
                <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">nCx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">nCx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">nCx</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="n">nCy</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="n">nCy</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="n">nCy</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">X3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nCz</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nCz</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">nCz</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">X3</span><span class="p">]</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y1</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">Y3</span><span class="p">]</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Z1</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">Z3</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="n">Z</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x2&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;x3&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_image_tensor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">numbering</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">annotation_color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="s2">&quot;annotationColor&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">annotation_color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;annotationColor&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;annotationColor has been deprecated, please use annotation_color&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
                <span class="n">ph</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                <span class="n">ph</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plot_image_tensor2D</span><span class="p">(</span>
                <span class="n">v</span><span class="p">,</span>
                <span class="n">v_type</span><span class="o">=</span><span class="n">v_type</span><span class="p">,</span>
                <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
                <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
                <span class="n">stream_opts</span><span class="o">=</span><span class="n">stream_opts</span><span class="p">,</span>
                <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
                <span class="n">range_x</span><span class="o">=</span><span class="n">range_x</span><span class="p">,</span>
                <span class="n">range_y</span><span class="o">=</span><span class="n">range_y</span><span class="p">,</span>
                <span class="n">sample_grid</span><span class="o">=</span><span class="n">sample_grid</span><span class="p">,</span>
                <span class="n">stream_threshold</span><span class="o">=</span><span class="n">stream_threshold</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># get copy of image and average to cell-centers is necessary</span>
            <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
                <span class="n">vc</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
                <span class="n">vc</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveN2CC</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Fz&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">]:</span>
                <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;2CCV&quot;</span>
                <span class="c1"># n = getattr(self, &#39;vn&#39;+v_type[0])</span>
                <span class="c1"># if &#39;x&#39; in v_type: v = np.r_[v, np.zeros(n[1]), np.zeros(n[2])]</span>
                <span class="c1"># if &#39;y&#39; in v_type: v = np.r_[np.zeros(n[0]), v, np.zeros(n[2])]</span>
                <span class="c1"># if &#39;z&#39; in v_type: v = np.r_[np.zeros(n[0]), np.zeros(n[1]), v]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>  <span class="c1"># average to cell centers</span>
                <span class="n">ind_xyz</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="n">v_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)[</span>
                    <span class="n">ind_xyz</span>
                <span class="p">]</span>

            <span class="n">nCx</span><span class="p">,</span> <span class="n">nCy</span><span class="p">,</span> <span class="n">nCz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span>
            <span class="c1"># determine number oE slices in x and y dimension</span>
            <span class="n">nX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nCz</span><span class="p">)))</span>
            <span class="n">nY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nCz</span> <span class="o">/</span> <span class="n">nX</span><span class="p">))</span>

            <span class="c1">#  allocate space for montage</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nX</span> <span class="o">*</span> <span class="n">nCx</span><span class="p">,</span> <span class="n">nY</span> <span class="o">*</span> <span class="n">nCy</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nY</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nX</span><span class="p">)):</span>
                    <span class="n">iz</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">+</span> <span class="n">iy</span> <span class="o">*</span> <span class="n">nX</span>
                    <span class="k">if</span> <span class="n">iz</span> <span class="o">&lt;</span> <span class="n">nCz</span><span class="p">:</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">ix</span> <span class="o">*</span> <span class="n">nCx</span> <span class="p">:</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nCx</span><span class="p">,</span> <span class="n">iy</span> <span class="o">*</span> <span class="n">nCy</span> <span class="p">:</span> <span class="p">(</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nCy</span><span class="p">]</span> <span class="o">=</span> <span class="n">vc</span><span class="p">[</span>
                            <span class="p">:,</span> <span class="p">:,</span> <span class="n">iz</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">C</span><span class="p">[</span><span class="n">ix</span> <span class="o">*</span> <span class="n">nCx</span> <span class="p">:</span> <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nCx</span><span class="p">,</span> <span class="n">iy</span> <span class="o">*</span> <span class="n">nCy</span> <span class="p">:</span> <span class="p">(</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nCy</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="n">C</span><span class="p">)</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nX</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())]</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())]</span>
            <span class="c1"># Plot the mesh</span>

            <span class="n">ph</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">**</span><span class="n">pcolor_opts</span><span class="p">)</span>
            <span class="c1"># Plot the lines</span>
            <span class="n">gx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">gy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nY</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Repeat and seperate with NaN</span>
            <span class="n">gxX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">gx</span><span class="p">,</span> <span class="n">gx</span><span class="p">,</span> <span class="n">gx</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">gxY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">nY</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
            <span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">gyX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nY</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">nX</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">])</span>
            <span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">gyY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">gy</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gy</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gxX</span><span class="p">,</span> <span class="n">gxY</span><span class="p">,</span> <span class="n">annotation_color</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gyX</span><span class="p">,</span> <span class="n">gyY</span><span class="p">,</span> <span class="n">annotation_color</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numbering</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.04</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nY</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nX</span><span class="p">)):</span>
                        <span class="n">iz</span> <span class="o">=</span> <span class="n">ix</span> <span class="o">+</span> <span class="n">iy</span> <span class="o">*</span> <span class="n">nX</span>
                        <span class="k">if</span> <span class="n">iz</span> <span class="o">&lt;</span> <span class="n">nCz</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">iy</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">pad</span><span class="p">,</span>
                                <span class="s2">&quot;#</span><span class="si">{0:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iz</span><span class="p">),</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">annotation_color</span><span class="p">,</span>
                                <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="s2">&quot;x-large&quot;</span><span class="p">,</span>
                            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">v_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ph</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__plot_image_tensor2D</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Common function for plotting an image of a TensorMesh&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;ax must be an matplotlib.axes.Axes&quot;</span><span class="p">)</span>

        <span class="c1"># Reshape to a cell centered variable</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CCv&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">!=</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Other types for CCv not supported&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">]:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;2CCV&quot;</span> <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span> <span class="k">else</span> <span class="s2">&quot;2CC&quot;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>  <span class="c1"># average to cell centers (might be a vector)</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">]:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;2CCV&quot;</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>  <span class="c1"># average to cell centers (might be a vector)</span>
            <span class="n">xORy</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}[</span><span class="n">v_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)[:,</span> <span class="n">xORy</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">view</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># e.g. np.real(v)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">,</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">pcolor_opts</span><span class="p">,</span> <span class="o">**</span><span class="n">grid_opts</span><span class="p">},</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;vec&quot;</span><span class="p">]:</span>
            <span class="c1"># Matplotlib seems to not support irregular</span>
            <span class="c1"># spaced vectors at the moment. So we will</span>
            <span class="c1"># Interpolate down to a regular mesh at the</span>
            <span class="c1"># smallest mesh size in this 2D slice.</span>
            <span class="k">if</span> <span class="n">sample_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hxmin</span> <span class="o">=</span> <span class="n">sample_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">hymin</span> <span class="o">=</span> <span class="n">sample_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hxmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">hymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nxi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="n">hxmin</span><span class="p">)</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nxi</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">nxi</span>
                <span class="n">origin_x</span> <span class="o">=</span> <span class="n">range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nxi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">hxmin</span><span class="p">)</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nxi</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">nxi</span>
                <span class="n">origin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="n">range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nyi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dy</span> <span class="o">/</span> <span class="n">hymin</span><span class="p">)</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nyi</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">nyi</span>
                <span class="n">origin_y</span> <span class="o">=</span> <span class="n">range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nyi</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">hymin</span><span class="p">)</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nyi</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">nyi</span>
                <span class="n">origin_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>

            <span class="n">tMi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="p">[</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">origin_x</span><span class="p">,</span> <span class="n">origin_y</span><span class="p">])</span>
            <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interpolation_matrix</span><span class="p">(</span><span class="n">tMi</span><span class="o">.</span><span class="n">gridCC</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="n">zerosOutside</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">Ui</span> <span class="o">=</span> <span class="n">tMi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
            <span class="n">Vi</span> <span class="o">=</span> <span class="n">tMi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">V</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
            <span class="c1"># End Interpolation</span>

            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span>

            <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">tMi</span><span class="o">.</span><span class="n">nodes_x</span>

            <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">tMi</span><span class="o">.</span><span class="n">nodes_y</span>

            <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># use interpolated values</span>
                <span class="n">U</span> <span class="o">=</span> <span class="n">Ui</span>
                <span class="n">V</span> <span class="o">=</span> <span class="n">Vi</span>

            <span class="k">if</span> <span class="n">stream_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask_me</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ui</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Vi</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">stream_threshold</span>
                <span class="n">Ui</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask_me</span><span class="p">,</span> <span class="n">Ui</span><span class="p">)</span>
                <span class="n">Vi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask_me</span><span class="p">,</span> <span class="n">Vi</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">stream_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scaleFact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">stream_thickness</span><span class="p">)</span>

                <span class="c1"># Calculate vector amplitude</span>
                <span class="n">vecAmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">V</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

                <span class="c1"># Form bounds to knockout the top and bottom 10%</span>
                <span class="n">vecAmp_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">vecAmp</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
                <span class="n">nVecAmp</span> <span class="o">=</span> <span class="n">vecAmp</span><span class="o">.</span><span class="n">size</span>
                <span class="n">tenPercInd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">nVecAmp</span><span class="p">))</span>
                <span class="n">lowerBound</span> <span class="o">=</span> <span class="n">vecAmp_sort</span><span class="p">[</span><span class="n">tenPercInd</span><span class="p">]</span>
                <span class="n">upperBound</span> <span class="o">=</span> <span class="n">vecAmp_sort</span><span class="p">[</span><span class="o">-</span><span class="n">tenPercInd</span><span class="p">]</span>

                <span class="n">lowInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vecAmp</span> <span class="o">&lt;</span> <span class="n">lowerBound</span><span class="p">)</span>
                <span class="n">vecAmp</span><span class="p">[</span><span class="n">lowInds</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowerBound</span>

                <span class="n">highInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">vecAmp</span> <span class="o">&gt;</span> <span class="n">upperBound</span><span class="p">)</span>
                <span class="n">vecAmp</span><span class="p">[</span><span class="n">highInds</span><span class="p">]</span> <span class="o">=</span> <span class="n">upperBound</span>

                <span class="c1"># Normalize amplitudes 0-1</span>
                <span class="n">norm_thickness</span> <span class="o">=</span> <span class="n">vecAmp</span> <span class="o">/</span> <span class="n">vecAmp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

                <span class="c1"># Scale by user defined thickness factor</span>
                <span class="n">stream_thickness</span> <span class="o">=</span> <span class="n">scaleFact</span> <span class="o">*</span> <span class="n">norm_thickness</span>

                <span class="c1"># Add linewidth to stream_opts</span>
                <span class="n">stream_opts</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="n">stream_thickness</span><span class="p">})</span>

            <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">U</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">V</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">pcolor_opts</span><span class="p">,</span> <span class="o">**</span><span class="n">grid_opts</span><span class="p">},</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span>
                    <span class="n">tMi</span><span class="o">.</span><span class="n">cell_centers_x</span><span class="p">,</span>
                    <span class="n">tMi</span><span class="o">.</span><span class="n">cell_centers_y</span><span class="p">,</span>
                    <span class="n">Ui</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="n">Vi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">stream_opts</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">range_x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">range_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__plot_slice_tensor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">normal</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">dim_ind</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="n">normal</span><span class="p">]</span>
        <span class="n">szSliceDim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span><span class="p">[</span><span class="n">dim_ind</span><span class="p">]</span>  <span class="c1">#: Size of the sliced dimension</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">szSliceDim</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ind must be an integer&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">getIndSlice</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">ind</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">def</span> <span class="nf">doSlice</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">getIndSlice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CCv&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">view</span> <span class="o">!=</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Other types for CCv not supported&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Now just deal with &#39;F&#39; and &#39;E&#39; (x, y, z, maybe...)</span>
                <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;2CCV&quot;</span> <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span> <span class="k">else</span> <span class="s2">&quot;2CC&quot;</span><span class="p">)</span>
                <span class="n">Av</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">Av</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_type</span><span class="p">)</span>  <span class="c1"># get specific component</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>
                <span class="c1"># we should now be averaged to cell centers (might be a vector)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="n">outSlice</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="s2">&quot;X&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
                    <span class="n">outSlice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getIndSlice</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s2">&quot;Y&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
                    <span class="n">outSlice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getIndSlice</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s2">&quot;Z&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
                    <span class="n">outSlice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getIndSlice</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">mkvc</span><span class="p">(</span><span class="n">outSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">outSlice</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">getIndSlice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">))</span>

        <span class="n">h2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x2d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;X&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
            <span class="n">h2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">x2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Y&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
            <span class="n">h2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">x2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Z&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normal</span><span class="p">:</span>
            <span class="n">h2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">x2d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">tM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">h2d</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">x2d</span><span class="p">)</span>  <span class="c1">#: Temp Mesh</span>
        <span class="n">v2d</span> <span class="o">=</span> <span class="n">doSlice</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">tM</span><span class="o">.</span><span class="n">__plot_image_tensor2D</span><span class="p">(</span>
            <span class="n">v2d</span><span class="p">,</span>
            <span class="n">v_type</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;CCv&quot;</span> <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span> <span class="k">else</span> <span class="s2">&quot;CC&quot;</span><span class="p">),</span>
            <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
            <span class="n">view</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
            <span class="n">stream_opts</span><span class="o">=</span><span class="n">stream_opts</span><span class="p">,</span>
            <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
            <span class="n">range_x</span><span class="o">=</span><span class="n">range_x</span><span class="p">,</span>
            <span class="n">range_y</span><span class="o">=</span><span class="n">range_y</span><span class="p">,</span>
            <span class="n">sample_grid</span><span class="o">=</span><span class="n">sample_grid</span><span class="p">,</span>
            <span class="n">stream_threshold</span><span class="o">=</span><span class="n">stream_threshold</span><span class="p">,</span>
            <span class="n">stream_thickness</span><span class="o">=</span><span class="n">stream_thickness</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span> <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span> <span class="k">else</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span> <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span> <span class="k">else</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Slice </span><span class="si">{0:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="c1"># CylindricalMesh plotting</span>
    <span class="k">def</span> <span class="nf">__plotCylTensorMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotType</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;We have not yet implemented this type of view.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;plot_image&quot;</span><span class="p">,</span> <span class="s2">&quot;plot_grid&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;plotType must be either &#39;plot_grid&#39; or &#39;plot_image&#39;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">v_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;v_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mirror</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mirror&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">mirror_data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;mirror_data&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mirror_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mirror</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mirror</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">v_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">v_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;CCV&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveF2CCV</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mirror_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mirror_data</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveF2CCV</span> <span class="o">*</span> <span class="n">mirror_data</span><span class="p">)</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;v_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;CCv&quot;</span>  <span class="c1"># now the vector is cell centered</span>
                <span class="k">if</span> <span class="n">v_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveE2CCV</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mirror_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">mirror_data</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveE2CCV</span> <span class="o">*</span> <span class="n">mirror_data</span><span class="p">)</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">mirror</span><span class="p">:</span>
            <span class="c1"># create a mirrored mesh</span>
            <span class="n">hx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">origin0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">discretize</span><span class="o">.</span><span class="n">TensorMesh</span><span class="p">([</span><span class="n">hx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="n">origin0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="k">if</span> <span class="n">mirror_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mirror_data</span> <span class="o">=</span> <span class="n">val</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">:</span>  <span class="c1"># only a single value at cell centers</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
                <span class="n">mirror_val</span> <span class="o">=</span> <span class="n">mirror_data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">mirror_val</span><span class="p">),</span> <span class="n">val</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">:</span>
                <span class="n">val_x</span> <span class="o">=</span> <span class="n">val</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
                <span class="n">val_z</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>

                <span class="n">mirror_x</span> <span class="o">=</span> <span class="n">mirror_data</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
                <span class="p">)</span>
                <span class="n">mirror_z</span> <span class="o">=</span> <span class="n">mirror_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nC</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span>
                <span class="p">)</span>

                <span class="n">val_x</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">mirror_x</span><span class="p">),</span> <span class="n">val_x</span><span class="p">])</span>
                <span class="p">)</span>  <span class="c1"># by symmetry</span>
                <span class="n">val_z</span> <span class="o">=</span> <span class="n">mkvc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">mirror_z</span><span class="p">),</span> <span class="n">val_z</span><span class="p">]))</span>

                <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">val_x</span><span class="p">,</span> <span class="n">val_z</span><span class="p">])</span>

            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">discretize</span><span class="o">.</span><span class="n">TensorMesh</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;ax must be an matplotlib.axes.Axes&quot;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">out</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">plotType</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__plot_grid_cyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_symmetric</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotCylTensorMesh</span><span class="p">(</span><span class="s2">&quot;plot_grid&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># allow a slice to be provided for the mesh</span>
        <span class="n">slc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;slice&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">slc</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slc</span> <span class="o">=</span> <span class="n">slc</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">slc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;slice must be either &#39;theta&#39;,&#39;z&#39;, or &#39;both&#39; not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slc</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># if slc is None, provide slices in both the theta and z directions</span>
        <span class="k">if</span> <span class="n">slc</span> <span class="o">==</span> <span class="s2">&quot;theta&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotGridThetaSlice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">slc</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotGridZSlice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;two axes handles must be provided to plot both theta &quot;</span>
                        <span class="s2">&quot;and z slices through the mesh. Over-writing the axes.&quot;</span>
                    <span class="p">)</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># find the one with a polar projection and pass it to the</span>
                    <span class="c1"># theta slice, other one to the z-slice</span>
                    <span class="n">polarax</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;PolarAxesSubplot&quot;</span>
                    <span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polarax</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                            No polar axes provided. Over-writing the axes. If you prefer to create your</span>
<span class="sd">                            own, please use</span>

<span class="sd">                                `ax = plt.subplot(121, projection=&#39;polar&#39;)`</span>

<span class="sd">                            for reference, see: http://matplotlib.org/examples/pylab_examples/polar_demo.html</span>
<span class="sd">                                                https://github.com/matplotlib/matplotlib/issues/312</span>
<span class="sd">                            &quot;&quot;&quot;</span>
                        <span class="p">)</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">polarax</span> <span class="o">=</span> <span class="n">polarax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">cartax</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">polarax</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># ax may have been None to start with or set to None</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
                <span class="n">polarax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;polar&quot;</span><span class="p">)</span>
                <span class="n">cartax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>

            <span class="c1"># update kwargs with respective axes handles</span>
            <span class="n">kwargspolar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">kwargspolar</span><span class="p">[</span><span class="s2">&quot;ax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polarax</span>

            <span class="n">kwargscart</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">kwargscart</span><span class="p">[</span><span class="s2">&quot;ax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cartax</span>

            <span class="n">ax</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotGridZSlice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargspolar</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__plotGridThetaSlice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargscart</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plotGridThetaSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># make a cyl symmetric mesh</span>
        <span class="n">h2d</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="n">mesh2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="n">h2d</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh2D</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__plotGridZSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># https://github.com/matplotlib/matplotlib/issues/312</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;PolarAxesSubplot&quot;</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    Creating new axes with Polar projection. If you prefer to create your own, please use</span>

<span class="sd">                        `ax = plt.subplot(121, projection=&#39;polar&#39;)`</span>

<span class="sd">                    for reference, see: http://matplotlib.org/examples/pylab_examples/polar_demo.html</span>
<span class="sd">                                        https://github.com/matplotlib/matplotlib/issues/312</span>
<span class="sd">                    &quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;polar&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;polar&quot;</span><span class="p">)</span>

        <span class="c1"># radial lines</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="n">ndgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="n">NN</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vnN</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnN</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="p">[</span><span class="n">NN</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">NN</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]),</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]),</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_cells</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]),</span>
            <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;C0&quot;</span><span class="p">)</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linewidth&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y1</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>

        <span class="c1"># circles</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">XY2</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_image_cyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__plotCylTensorMesh</span><span class="p">(</span><span class="s2">&quot;plot_image&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># CurvilinearMesh plotting:</span>
    <span class="k">def</span> <span class="nf">__plot_grid_curv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

                <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:]),</span>
                    <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
                <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">]</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y1</span><span class="p">,</span> <span class="n">Y2</span><span class="p">]</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Z1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Z2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">X3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">Z3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">:]),</span>
                <span class="n">mkvc</span><span class="p">(</span><span class="n">NN</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
            <span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span> <span class="n">X3</span><span class="p">]</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Y1</span><span class="p">,</span> <span class="n">Y2</span><span class="p">,</span> <span class="n">Y3</span><span class="p">]</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">Z1</span><span class="p">,</span> <span class="n">Z2</span><span class="p">,</span> <span class="n">Z3</span><span class="p">]</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;x3&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridN</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridFz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridEz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x2&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_image_curv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This is not yet done!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Vector ploting is not supported on CurvilinearMesh (yet)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">view</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># e.g. np.real(v)</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aveN2CC</span> <span class="o">*</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">]:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;2CCV&quot;</span>
            <span class="n">ind_xy</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}[</span><span class="n">v_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nC</span><span class="p">)[</span>
                <span class="n">ind_xy</span>
            <span class="p">]</span>  <span class="c1"># average to cell centers</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="n">I</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span>
            <span class="n">Y</span><span class="p">,</span>
            <span class="n">I</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vnC</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">pcolor_opts</span><span class="p">,</span>
            <span class="o">**</span><span class="n">grid_opts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">__plot_grid_tree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nodes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">centers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cell_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">faces_z</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges_x</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">edges_z</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">faces_x</span> <span class="o">=</span> <span class="n">faces_y</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">faces_z</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">edges_x</span> <span class="o">=</span> <span class="n">edges_y</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">edges_z</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">lines</span> <span class="ow">or</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">grid_n_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">grid_n_full</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># Hanging Nodes</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gridhN</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">centers</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cell_line</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">y_mark</span> <span class="o">=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="s2">&quot;^&quot;</span>

        <span class="k">if</span> <span class="n">faces_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_x</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hanging Faces x</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_x</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">faces_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_y</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">y_mark</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hanging Faces y</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">faces_z</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">faces_z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_z</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hangin Faces z</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_faces_z</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">edges_x</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_x</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hanging Edges x</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_x</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">edges_y</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_y</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">y_mark</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hanging Edges y</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">edges_z</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edges_z</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_z</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Hanging Edges z</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hanging_edges_z</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">edge_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_nodes</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">grid_n_full</span><span class="p">[</span><span class="n">edge_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">grid_n_full</span><span class="p">[</span><span class="n">edge_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">line_segments</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">lines</span><span class="p">,</span> <span class="n">grid_n_full</span><span class="p">[</span><span class="n">edge_nodes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
                <span class="n">line_segments</span> <span class="o">=</span> <span class="n">Line3DCollection</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">line_segments</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x1&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;x3&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">__plot_image_tree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quiver_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;plotImage is not implemented for 3D TreeMesh, please use plotSlice&quot;</span>
            <span class="p">)</span>
        <span class="c1"># reshape to cell_centered thing</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CCv&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">!=</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Other types for CCv not supported&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">]:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;2CCV&quot;</span> <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span> <span class="k">else</span> <span class="s2">&quot;2CC&quot;</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">]:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;2CCV&quot;</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
            <span class="n">ind_xy</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}[</span><span class="n">v_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">)[</span><span class="n">ind_xy</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">]:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">view</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># e.g. np.real(v)</span>
        <span class="k">elif</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">isnot_nans</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

        <span class="c1"># pcolormesh call signature</span>
        <span class="c1"># def pcolormesh(self, *args, alpha=None, norm=None, cmap=None, vmin=None,</span>
        <span class="c1">#            vmax=None, shading=&#39;flat&#39;, antialiased=False, **kwargs):</span>

        <span class="c1"># make a shallow copy so we can pop items off for the pass to PolyCollection</span>
        <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmin&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;vmax&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">shading</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;shading&quot;</span><span class="p">,</span> <span class="s2">&quot;flat&quot;</span><span class="p">)</span>
        <span class="n">antialiased</span> <span class="o">=</span> <span class="n">pcolor_opts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;antialiased&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">node_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hanging_nodes</span><span class="p">]</span>
        <span class="n">cell_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_nodes</span><span class="p">[:,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="n">cell_nodes</span> <span class="o">=</span> <span class="n">cell_nodes</span><span class="p">[</span><span class="n">isnot_nans</span><span class="p">]</span>
        <span class="n">cell_verts</span> <span class="o">=</span> <span class="n">node_grid</span><span class="p">[</span><span class="n">cell_nodes</span><span class="p">]</span>

        <span class="c1"># Below taken from pcolormesh source code with QuadMesh exchanged to PolyCollection</span>
        <span class="n">collection</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span>
            <span class="n">cell_verts</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="n">antialiased</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="n">pcolor_opts</span><span class="p">,</span> <span class="o">**</span><span class="n">grid_opts</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">isnot_nans</span><span class="p">])</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">set_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">set_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">_scale_norm</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>
            <span class="n">collection</span><span class="o">.</span><span class="n">autoscale_None</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">autolim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="n">range_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_x</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">range_y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_y</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">collection</span><span class="o">.</span><span class="n">sticky_edges</span><span class="o">.</span><span class="n">x</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">]</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">sticky_edges</span><span class="o">.</span><span class="n">y</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">]</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">),</span> <span class="p">(</span><span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">update_datalim</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">_request_autoscale_view</span><span class="p">()</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">,)</span>

        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">quiver_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">quiver_opts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># make a copy so we can set some defaults without modifying the original</span>
            <span class="n">quiver_opts</span> <span class="o">=</span> <span class="n">quiver_opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">quiver_opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;pivot&quot;</span><span class="p">,</span> <span class="s2">&quot;mid&quot;</span><span class="p">)</span>

            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">)</span>
            <span class="n">qvr</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="o">**</span><span class="n">quiver_opts</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">qvr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__plot_slice_tree</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">normal</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span>
        <span class="n">ind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stream_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">grid_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quiver_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">normalInd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="n">normal</span><span class="p">]</span>
        <span class="n">antiNormalInd</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}[</span><span class="n">normal</span><span class="p">]</span>

        <span class="n">h2d</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">x2d</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1">#: Size of the sliced dimension</span>
        <span class="n">szSliceDim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">normalInd</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">szSliceDim</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">cc_tensor</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">cc_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">cc_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cc_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cc_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">slice_loc</span> <span class="o">=</span> <span class="n">cc_tensor</span><span class="p">[</span><span class="n">normalInd</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ind must be an integer&quot;</span><span class="p">)</span>

        <span class="c1"># create a temporary TreeMesh with the slice through</span>
        <span class="n">temp_mesh</span> <span class="o">=</span> <span class="n">discretize</span><span class="o">.</span><span class="n">TreeMesh</span><span class="p">(</span><span class="n">h2d</span><span class="p">,</span> <span class="n">x2d</span><span class="p">)</span>
        <span class="n">level_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_level</span> <span class="o">-</span> <span class="n">temp_mesh</span><span class="o">.</span><span class="n">max_level</span>

        <span class="n">XS</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">XS</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">XS</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span>
            <span class="n">cc_tensor</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">cc_tensor</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="n">XS</span><span class="p">[</span><span class="n">normalInd</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">XS</span><span class="p">[</span><span class="n">antiNormalInd</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">slice_loc</span>
        <span class="n">loc_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">XS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">XS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">XS</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_containing_cell_indexes</span><span class="p">(</span><span class="n">loc_grid</span><span class="p">))</span>

        <span class="n">grid2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridCC</span><span class="p">[</span><span class="n">inds</span><span class="p">][:,</span> <span class="n">antiNormalInd</span><span class="p">]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cell_levels_by_indexes</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">-</span> <span class="n">level_diff</span>
        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">insert_cells</span><span class="p">(</span><span class="n">grid2d</span><span class="p">,</span> <span class="n">levels</span><span class="p">)</span>
        <span class="n">tm_gridboost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">temp_mesh</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">tm_gridboost</span><span class="p">[:,</span> <span class="n">antiNormalInd</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_mesh</span><span class="o">.</span><span class="n">gridCC</span>
        <span class="n">tm_gridboost</span><span class="p">[:,</span> <span class="n">normalInd</span><span class="p">]</span> <span class="o">=</span> <span class="n">slice_loc</span>

        <span class="c1"># interpolate values to self.gridCC if not &quot;CC&quot; or &quot;CCv&quot;</span>
        <span class="k">if</span> <span class="n">v_type</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span> <span class="o">+</span> <span class="s2">&quot;2CC&quot;</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="n">aveOp</span> <span class="o">+=</span> <span class="s2">&quot;V&quot;</span>
            <span class="n">Av</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Av</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cells</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_type</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># was one of Fx, Fy, Fz, Ex, Ey, Ez</span>
                <span class="c1"># assuming v has all three components in these cases</span>
                <span class="n">vec_ind</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}[</span><span class="n">v_type</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span>
                    <span class="n">i_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nEx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nEy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nEz</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
                    <span class="n">i_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFz</span><span class="p">])</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i_s</span><span class="p">[</span><span class="n">vec_ind</span><span class="p">]</span> <span class="p">:</span> <span class="n">i_s</span><span class="p">[</span><span class="n">vec_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>
        <span class="k">elif</span> <span class="n">v_type</span> <span class="o">==</span> <span class="s2">&quot;CCv&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view</span> <span class="o">!=</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Other types for CCv not supported&quot;</span><span class="p">)</span>
        <span class="n">slice_view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="n">slice_view</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span>
            <span class="n">vecs</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:,</span> <span class="n">antiNormalInd</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># interpolate values from self.gridCC to grid2d</span>
        <span class="n">ind_3d_to_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_containing_cell_indexes</span><span class="p">(</span><span class="n">tm_gridboost</span><span class="p">)</span>
        <span class="n">v2d</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">ind_3d_to_2d</span><span class="p">]</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">temp_mesh</span><span class="o">.</span><span class="n">plot_image</span><span class="p">(</span>
            <span class="n">v2d</span><span class="p">,</span>
            <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
            <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span>
            <span class="n">view</span><span class="o">=</span><span class="n">slice_view</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">pcolor_opts</span><span class="o">=</span><span class="n">pcolor_opts</span><span class="p">,</span>
            <span class="n">grid_opts</span><span class="o">=</span><span class="n">grid_opts</span><span class="p">,</span>
            <span class="n">range_x</span><span class="o">=</span><span class="n">range_x</span><span class="p">,</span>
            <span class="n">range_y</span><span class="o">=</span><span class="n">range_y</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span> <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;X&quot;</span> <span class="k">else</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span> <span class="k">if</span> <span class="n">normal</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span> <span class="k">else</span> <span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Slice </span><span class="si">{0:d}</span><span class="s2">, </span><span class="si">{1!s}</span><span class="s2"> = </span><span class="si">{2:4.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">normal</span><span class="p">,</span> <span class="n">slice_loc</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">view</span> <span class="o">==</span> <span class="s2">&quot;vec&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">quiver_opts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">quiver_opts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># make a copy so we can set some defaults without modifying the original</span>
            <span class="n">quiver_opts</span> <span class="o">=</span> <span class="n">quiver_opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">quiver_opts</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;pivot&quot;</span><span class="p">,</span> <span class="s2">&quot;mid&quot;</span><span class="p">)</span>
            <span class="n">vecs</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[</span><span class="n">ind_3d_to_2d</span><span class="p">]</span>
            <span class="n">qvr</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                <span class="n">temp_mesh</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">temp_mesh</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">vecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">vecs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="o">**</span><span class="n">quiver_opts</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">qvr</span><span class="p">,)</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="n">plotGrid</span> <span class="o">=</span> <span class="n">deprecate_method</span><span class="p">(</span><span class="s2">&quot;plot_grid&quot;</span><span class="p">,</span> <span class="s2">&quot;plotGrid&quot;</span><span class="p">,</span> <span class="n">removal_version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
    <span class="n">plotImage</span> <span class="o">=</span> <span class="n">deprecate_method</span><span class="p">(</span><span class="s2">&quot;plot_image&quot;</span><span class="p">,</span> <span class="s2">&quot;plotImage&quot;</span><span class="p">,</span> <span class="n">removal_version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span>
    <span class="n">plotSlice</span> <span class="o">=</span> <span class="n">deprecate_method</span><span class="p">(</span><span class="s2">&quot;plot_slice&quot;</span><span class="p">,</span> <span class="s2">&quot;plotSlice&quot;</span><span class="p">,</span> <span class="n">removal_version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Slicer"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.Slicer.html#discretize.mixins.mpl_mod.Slicer">[docs]</a><span class="k">class</span> <span class="nc">Slicer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot slices of a 3D volume, interactively (scroll wheel).</span>

<span class="sd">    If called from a notebook, make sure to set</span>

<span class="sd">        %matplotlib notebook</span>

<span class="sd">    The straight forward usage for the Slicer is through, e.g., a</span>
<span class="sd">    `TensorMesh`-mesh, by accessing its `mesh.plot_3d_slicer`.</span>

<span class="sd">    If you, however, call this class directly, you have first to initiate a</span>
<span class="sd">    figure, and afterwards connect it:</span>

<span class="sd">    &gt;&gt;&gt; # You have to initialize a figure</span>
<span class="sd">    &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; # Then you have to get the tracker from the Slicer</span>
<span class="sd">    &gt;&gt;&gt; tracker = discretize.View.Slicer(mesh, Lpout)</span>
<span class="sd">    &gt;&gt;&gt; # Finally you have to connect the tracker to the figure</span>
<span class="sd">    &gt;&gt;&gt; fig.canvas.mpl_connect(&#39;scroll_event&#39;, tracker.onscroll)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>


<span class="sd">    **Parameters**</span>

<span class="sd">    v : array</span>
<span class="sd">        Data array of length self.nC.</span>

<span class="sd">    xslice, yslice, zslice : floats, optional</span>
<span class="sd">        Initial slice locations (in meter);</span>
<span class="sd">        defaults to the middle of the volume.</span>

<span class="sd">    v_type: str</span>
<span class="sd">        Type of visualization. Default is &#39;CC&#39;.</span>
<span class="sd">        One of [&#39;CC&#39;, &#39;Fx&#39;, &#39;Fy&#39;, &#39;Fz&#39;, &#39;Ex&#39;, &#39;Ey&#39;, &#39;Ez&#39;].</span>

<span class="sd">    view : str</span>
<span class="sd">        Which component to show. Defaults to &#39;real&#39;.</span>
<span class="sd">        One of  [&#39;real&#39;, &#39;imag&#39;, &#39;abs&#39;].</span>

<span class="sd">    axis : &#39;xy&#39; (default) or &#39;yx&#39;</span>
<span class="sd">        &#39;xy&#39;: horizontal axis is x, vertical axis is y. Reversed otherwise.</span>

<span class="sd">    transparent : &#39;slider&#39; or list of floats or pairs of floats, optional</span>
<span class="sd">        Values to be removed. E.g. air, water.</span>
<span class="sd">        If single value, only exact matches are removed. Pairs are treated as</span>
<span class="sd">        ranges. E.g. [0.3, [1, 4], [-np.infty, -10]] removes all values equal</span>
<span class="sd">        to 0.3, all values between 1 and 4, and all values smaller than -10.</span>
<span class="sd">        If &#39;slider&#39; is provided it will plot an interactive slider to choose</span>
<span class="sd">        the shown range.</span>

<span class="sd">    clim : None or list of [min, max]</span>
<span class="sd">        For `pcolormesh` (`vmin`, `vmax`). Note: if you use a `norm` (e.g.,</span>
<span class="sd">        `LogNorm`) then `vmin`/`vmax` have to be provided in the norm.</span>

<span class="sd">    xlim, ylim, zlim : None or list of [min, max]</span>
<span class="sd">        Axis limits.</span>

<span class="sd">    aspect : &#39;auto&#39;, &#39;equal&#39;, or num</span>
<span class="sd">        Aspect ratio of subplots. Defaults to &#39;auto&#39;.</span>

<span class="sd">        A list of two values can be provided. The first will be for the</span>
<span class="sd">        XY-plot, the second for the XZ- and YZ-plots, e.g. [&#39;equal&#39;, 2] to have</span>
<span class="sd">        the vertical dimension exaggerated by a factor of 2.</span>

<span class="sd">        WARNING: For anything else than &#39;auto&#39;, unexpected things might happen</span>
<span class="sd">                 when zooming, and the subplot-arrangement won&#39;t look pretty.</span>

<span class="sd">    grid : list of 3 int</span>
<span class="sd">        Number of cells occupied by x, y, and z dimension on plt.subplot2grid.</span>

<span class="sd">    pcolor_opts : dictionary</span>
<span class="sd">        Passed to `pcolormesh`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mesh</span><span class="p">,</span>
        <span class="n">v</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">yslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zslice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">v_type</span><span class="o">=</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span>
        <span class="n">view</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zlim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">grid</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">pcolor_opts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize interactive figure.&quot;&quot;&quot;</span>

        <span class="c1"># 0. Some checks, not very extensive</span>
        <span class="k">if</span> <span class="s2">&quot;pcolorOpts&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">pcolor_opts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;pcolorOpts&quot;</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;pcolorOpts has been deprecated, please use pcolor_opts&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Add pcolor_opts to self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span> <span class="o">=</span> <span class="n">pcolor_opts</span> <span class="k">if</span> <span class="n">pcolor_opts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># (a) Mesh dimensionality</span>
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;Must be a 3D mesh. Use plotImage instead.&quot;</span>
            <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot; Mesh provided has </span><span class="si">{}</span><span class="s2"> dimension(s).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># (b) v_type  # Not yet working for [&#39;CCv&#39;]</span>
        <span class="n">v_typeOpts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;Fx&quot;</span><span class="p">,</span> <span class="s2">&quot;Fy&quot;</span><span class="p">,</span> <span class="s2">&quot;Fz&quot;</span><span class="p">,</span> <span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">v_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v_typeOpts</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;v_type must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;].&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">v_typeOpts</span><span class="p">))</span>
            <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot; v_type provided: &#39;</span><span class="si">{0!s}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v_type</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v_type</span> <span class="o">!=</span> <span class="s2">&quot;CC&quot;</span><span class="p">:</span>
            <span class="n">aveOp</span> <span class="o">=</span> <span class="s2">&quot;ave&quot;</span> <span class="o">+</span> <span class="n">v_type</span> <span class="o">+</span> <span class="s2">&quot;2CC&quot;</span>
            <span class="n">Av</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">aveOp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">Av</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v_type</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_type</span><span class="p">)</span>  <span class="c1"># get specific component</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Av</span> <span class="o">*</span> <span class="n">v</span>

        <span class="c1"># (c) vOpts  # Not yet working for &#39;vec&#39;</span>

        <span class="c1"># Backwards compatibility</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xy&quot;</span><span class="p">,</span> <span class="s2">&quot;yx&quot;</span><span class="p">]:</span>
            <span class="n">axis</span> <span class="o">=</span> <span class="n">view</span>
            <span class="n">view</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span>

        <span class="n">viewOpts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">,</span> <span class="s2">&quot;imag&quot;</span><span class="p">,</span> <span class="s2">&quot;abs&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">view</span> <span class="ow">in</span> <span class="n">viewOpts</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">view</span><span class="p">)(</span><span class="n">v</span><span class="p">)</span>  <span class="c1"># e.g. np.real(v)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;view must be in [&#39;</span><span class="si">{0!s}</span><span class="s2">&#39;].&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&#39;, &#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">viewOpts</span><span class="p">))</span>
            <span class="n">err</span> <span class="o">+=</span> <span class="s2">&quot; view provided: &#39;</span><span class="si">{0!s}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c1"># 1. Store relevant data</span>

        <span class="c1"># Store data in self as (nx, ny, nz)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">nC</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;CC&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

        <span class="c1"># Store relevant information from mesh in self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes_x</span>  <span class="c1"># x-node locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes_y</span>  <span class="c1"># y-node locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes_z</span>  <span class="c1"># z-node locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers_x</span>  <span class="c1"># x-cell center locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers_y</span>  <span class="c1"># y-cell center locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers_z</span>  <span class="c1"># z-cell center locations</span>

        <span class="c1"># Axis: Default (&#39;xy&#39;): horizontal axis is x, vertical axis is y.</span>
        <span class="c1"># Reversed otherwise.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yx</span> <span class="o">=</span> <span class="n">axis</span> <span class="o">==</span> <span class="s2">&quot;yx&quot;</span>

        <span class="c1"># Store initial slice indices; if not provided, takes the middle.</span>
        <span class="k">if</span> <span class="n">xslice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span> <span class="o">-</span> <span class="n">xslice</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">yslice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yc</span> <span class="o">-</span> <span class="n">yslice</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">zslice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zc</span> <span class="o">-</span> <span class="n">zslice</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Aspect ratio</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">aspect1</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">aspect2</span> <span class="o">=</span> <span class="n">aspect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aspect1</span> <span class="o">=</span> <span class="n">aspect</span>
            <span class="n">aspect2</span> <span class="o">=</span> <span class="n">aspect</span>
        <span class="k">if</span> <span class="n">aspect2</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;equal&quot;</span><span class="p">]:</span>
            <span class="n">aspect3</span> <span class="o">=</span> <span class="n">aspect2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aspect3</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">aspect2</span>

        <span class="c1"># set color limits if clim is None (and norm doesn&#39;t have vmin, vmax).</span>
        <span class="k">if</span> <span class="n">clim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;norm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vmin</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;norm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vmax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">clim</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmin</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vmax</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="c1"># In the case of a homogeneous fullspace provide a small range to</span>
            <span class="c1"># avoid problems with colorbar and the three subplots.</span>
            <span class="k">if</span> <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">0.99</span>
                <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">1.01</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;vmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;vmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ensure vmin/vmax of the norm is consistent with clim</span>
        <span class="k">if</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;norm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vmin</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">[</span><span class="s2">&quot;norm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 2. Start populating figure</span>

        <span class="c1"># Get plot2grid dimension</span>
        <span class="n">figgrid</span> <span class="o">=</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># Create subplots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.075</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># X-Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span>
            <span class="n">figgrid</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rowspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="n">aspect1</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># X-Z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span>
            <span class="n">figgrid</span><span class="p">,</span>
            <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">colspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">rowspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">sharex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">aspect2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

        <span class="c1"># Z-Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span>
            <span class="n">figgrid</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">colspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">rowspan</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">sharey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="n">aspect3</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">zlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">zlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="c1"># Cross-line properties</span>
        <span class="c1"># We have to lines, a thick white one, and in the middle a thin black</span>
        <span class="c1"># one, to assure that the lines can be seen on dark and on bright</span>
        <span class="c1"># spots.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;zorder&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;zorder&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}</span>

        <span class="c1"># Initial draw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_xy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_xz</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_zy</span><span class="p">()</span>

        <span class="c1"># Create colorbar</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zy_pc</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>

        <span class="c1"># Remove transparent value</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">transparent</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">transparent</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;slider&quot;</span><span class="p">:</span>
            <span class="c1"># Sliders</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_smin</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ax_smax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>

            <span class="c1"># Limits slightly below/above actual limits, clips otherwise</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smin</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_smin</span><span class="p">,</span> <span class="s2">&quot;Min&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">clim</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smax</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax_smax</span><span class="p">,</span> <span class="s2">&quot;Max&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">clim</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">clim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Re-set</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smin</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smax</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
                <span class="c1"># Update plots</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_xy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_xz</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_zy</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">smax</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smin</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">transparent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># Loop over values</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">transparent</span><span class="p">:</span>
                <span class="c1"># If value is a list/tuple, we treat is as a range</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_inside</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Exact value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

            <span class="c1"># Update plots</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_xy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_xz</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_zy</span><span class="p">()</span>

        <span class="c1"># 3. Keep depth in X-Z and Z-Y in sync</span>

        <span class="k">def</span> <span class="nf">do_adjust</span><span class="p">():</span>
            <span class="sd">&quot;&quot;&quot;Return True if z-axis in X-Z and Z-Y are different.&quot;&quot;&quot;</span>
            <span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
            <span class="n">two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">two</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.001</span>  <span class="c1"># Difference at least 1 m.</span>

        <span class="k">def</span> <span class="nf">on_ylims_changed</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Adjust Z-Y if X-Z changed.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">do_adjust</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="k">def</span> <span class="nf">on_xlims_changed</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Adjust X-Z if Z-Y changed.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">do_adjust</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;xlim_changed&quot;</span><span class="p">,</span> <span class="n">on_xlims_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;ylim_changed&quot;</span><span class="p">,</span> <span class="n">on_ylims_changed</span><span class="p">)</span>

<div class="viewcode-block" id="Slicer.onscroll"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.Slicer.html#discretize.mixins.mpl_mod.Slicer.onscroll">[docs]</a>    <span class="k">def</span> <span class="nf">onscroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update index and data when scrolling.&quot;&quot;&quot;</span>

        <span class="c1"># Get scroll direction</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># Update slice index depending on subplot over which mouse is</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="p">:</span>  <span class="c1"># X-Y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zind</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_xy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="p">:</span>  <span class="c1"># X-Z</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_xz</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="p">:</span>  <span class="c1"># Z-Y</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yind</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="o">.</span><span class="n">size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span> <span class="o">+</span> <span class="n">pm</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="o">.</span><span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_zy</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>

<div class="viewcode-block" id="Slicer.update_xy"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.Slicer.html#discretize.mixins.mpl_mod.Slicer.update_xy">[docs]</a>    <span class="k">def</span> <span class="nf">update_xy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update plot for change in Z-index.&quot;&quot;&quot;</span>

        <span class="c1"># Clean up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_elements</span><span class="p">([</span><span class="s2">&quot;xy_pc&quot;</span><span class="p">,</span> <span class="s2">&quot;xz_ahw&quot;</span><span class="p">,</span> <span class="s2">&quot;xz_ahk&quot;</span><span class="p">,</span> <span class="s2">&quot;zy_avw&quot;</span><span class="p">,</span> <span class="s2">&quot;zy_avk&quot;</span><span class="p">])</span>

        <span class="c1"># Draw X-Y slice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="n">zdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">hor</span><span class="p">,</span> <span class="n">ver</span><span class="p">,</span> <span class="n">zdat</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">)</span>

        <span class="c1"># Draw Z-slice intersection in X-Z plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xz_ahw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xz_ahk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span>

        <span class="c1"># Draw Z-slice intersection in Z-Y plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zy_avw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zy_avk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">zind</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span></div>

<div class="viewcode-block" id="Slicer.update_xz"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.Slicer.html#discretize.mixins.mpl_mod.Slicer.update_xz">[docs]</a>    <span class="k">def</span> <span class="nf">update_xz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update plot for change in Y-index.&quot;&quot;&quot;</span>

        <span class="c1"># Clean up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_elements</span><span class="p">([</span><span class="s2">&quot;xz_pc&quot;</span><span class="p">,</span> <span class="s2">&quot;zy_ahk&quot;</span><span class="p">,</span> <span class="s2">&quot;zy_ahw&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_ahk&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_ahw&quot;</span><span class="p">])</span>

        <span class="c1"># Draw X-Z slice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ydat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yind</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">yind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xz_pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">hor</span><span class="p">,</span> <span class="n">ver</span><span class="p">,</span> <span class="n">ydat</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">)</span>

        <span class="c1"># Draw X-slice intersection in X-Y plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_ahw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_ahk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span>

        <span class="c1"># Draw X-slice intersection in Z-Y plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zy_ahw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zy_ahk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span></div>

<div class="viewcode-block" id="Slicer.update_zy"><a class="viewcode-back" href="../../../api/generated/discretize.mixins.mpl_mod.Slicer.html#discretize.mixins.mpl_mod.Slicer.update_zy">[docs]</a>    <span class="k">def</span> <span class="nf">update_zy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update plot for change in X-index.&quot;&quot;&quot;</span>

        <span class="c1"># Clean up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_elements</span><span class="p">([</span><span class="s2">&quot;zy_pc&quot;</span><span class="p">,</span> <span class="s2">&quot;xz_avw&quot;</span><span class="p">,</span> <span class="s2">&quot;xz_avk&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_avw&quot;</span><span class="p">,</span> <span class="s2">&quot;xy_avk&quot;</span><span class="p">])</span>

        <span class="c1"># Draw Z-Y slice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yx</span><span class="p">:</span>
            <span class="n">xdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yind</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">yind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xdat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">hor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zy_pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax3</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">hor</span><span class="p">,</span> <span class="n">ver</span><span class="p">,</span> <span class="n">xdat</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pc_props</span><span class="p">)</span>

        <span class="c1"># Draw Y-slice intersection in X-Y plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_avw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_avk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span>

        <span class="c1"># Draw Y-slice intersection in X-Z plot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xz_avw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xz_avk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">clpropsk</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_clear_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove elements from list &lt;names&gt; from plot if they exists.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" width="60px"; style="float:right;height:3em;line-height:3em;padding:10px 0 0 1em;">
        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    2013-2020,
    <a href="http://simpeg.xyz">SimPEG Developers.</a><br />
    Except where noted, this work is licensed under a <br />
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        Creative Commons Attribution 4.0 International License
    </a>
</div>
<br>
<div>
Built with
    <a href="http://sphinx-doc.org/">Sphinx</a>
    using a
    <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by
    <a href="https://readthedocs.org">Read the Docs</a>.
 </div>


</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>