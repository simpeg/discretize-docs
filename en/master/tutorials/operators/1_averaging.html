


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Averaging Matricies &mdash; discretize 0.4.9 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/logo-block.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Differential Operators" href="2_differential.html" />
    <link rel="prev" title="Operators" href="index.html" />
 

<meta name="description" content="Simulation and Parameter Estimation in Geophysics">
<meta name="author" content="SimPEG Developers">
<meta name="keywords" content="python, geophysics, inversion, electromagnetics, magnetotellurics, magnetics, gravity, DC, flow inverse problems, open source, finite volume">


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45185336-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> discretize
          

          
          </a>

          
            
            
              <div class="version">
                0.4.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../content/big_picture.html">Why discretize?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/additional_resources.html">Additional Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../mesh_generation/index.html">Mesh Generation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operators</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Averaging Matricies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#import-packages">Import Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-example">1D Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-2d-and-3d-averaging">1D, 2D and 3D Averaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#discontinuous-functions-and-the-transpose">Discontinuous Functions and the Transpose</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2_differential.html">Differential Operators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../inner_products/index.html">Inner Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pde/index.html">Solving PDEs</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Theory</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../content/finite_volume.html">Finite Volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../content/inner_products.html">Inner Products</a></li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">
            
                Getting connected
            
            </span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://simpeg.xyz"><i class="fa fa-external-link-square fa-fw"></i> SimPEG</a></li>
            
                <li class="toctree-l1"><a href="http://slack.simpeg.xyz"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/simpeg/discretize"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">discretize</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Operators</a> &raquo;</li>
        
      <li>Averaging Matricies</li>
    
    

    <li class="wy-breadcrumbs-aside">
        
            
                <a href="https://github.com/simpeg/discretize/edit/master/doc/tutorials/operators/1_averaging.rst"
                   class="fa fa-github"> Edit this page</a>
            
        
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-tutorials-operators-1-averaging-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="averaging-matricies">
<span id="sphx-glr-tutorials-operators-1-averaging-py"></span><h1>Averaging Matricies<a class="headerlink" href="#averaging-matricies" title="Permalink to this headline">¶</a></h1>
<p>Averaging matricies are used when a discrete variable living on some part of
the mesh (e.g. nodes, centers, edges or faces) must be approximated at other
locations. Averaging matricies are sparse and exist for 1D, 2D and
3D meshes. For each mesh class (<em>Tensor mesh</em>, <em>Tree mesh</em>,
<em>Curvilinear mesh</em>), the set of averaging matricies are properties that are
only constructed when called.</p>
<p>Here we discuss:</p>
<blockquote>
<div><ul class="simple">
<li>How to construct and apply averaging matricies</li>
<li>Averaging matricies in 1D, 2D and 3D</li>
<li>Averaging discontinuous functions</li>
<li>The transpose of an averaging matrix</li>
</ul>
</div></blockquote>
<div class="section" id="import-packages">
<h2>Import Packages<a class="headerlink" href="#import-packages" title="Permalink to this headline">¶</a></h2>
<p>Here we import the packages required for this tutorial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">discretize</span> <span class="k">import</span> <span class="n">TensorMesh</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># sphinx_gallery_thumbnail_number = 3</span>
</pre></div>
</div>
</div>
<div class="section" id="d-example">
<h2>1D Example<a class="headerlink" href="#d-example" title="Permalink to this headline">¶</a></h2>
<p>Here we compute a scalar function on cell nodes and average to cell centers.
We then compute the scalar function at cell centers to validate the
averaging operator.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a uniform grid</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">TensorMesh</span><span class="p">([</span><span class="n">h</span><span class="p">],</span> <span class="s1">&#39;C&#39;</span><span class="p">)</span>

<span class="c1"># Get node and cell center locations</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vectorNx</span>
<span class="n">x_centers</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vectorCCx</span>


<span class="c1"># Define a continuous function</span>
<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.exp.html#numpy.exp" title="View documentation for numpy.exp"><span class="n">np</span><span class="o">.</span><span class="n">exp</span></a><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">50</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Compute function on nodes and cell centers</span>
<span class="n">v_nodes</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span>
<span class="n">v_centers</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">x_centers</span><span class="p">)</span>

<span class="c1"># Create operator and average from nodes to cell centers</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aveN2CC</span>
<span class="n">v_approx</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">v_nodes</span>

<span class="c1"># Compare</span>
<span class="n">fig</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.91</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sparse representation of A&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_centers</span><span class="p">,</span> <span class="n">v_centers</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span>
         <span class="n">x_centers</span><span class="p">,</span> <span class="n">v_approx</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span>
         <span class="n">x_centers</span><span class="p">,</span> <a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.c_.html#numpy.c_" title="View documentation for numpy.c_"><span class="n">np</span><span class="o">.</span><span class="n">c_</span></a><span class="p">[</span><span class="n">v_centers</span><span class="o">-</span><span class="n">v_approx</span><span class="p">],</span> <span class="s1">&#39;r-&#39;</span>
         <span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison plot&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;evaluated at centers&#39;</span><span class="p">,</span> <span class="s1">&#39;averaged from nodes&#39;</span><span class="p">,</span> <span class="s1">&#39;absolute error&#39;</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_1_averaging_001.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_1_averaging_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/travis/build/simpeg/discretize/tutorials/operators/1_averaging.py:81: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre></div>
</div>
</div>
<div class="section" id="d-2d-and-3d-averaging">
<h2>1D, 2D and 3D Averaging<a class="headerlink" href="#d-2d-and-3d-averaging" title="Permalink to this headline">¶</a></h2>
<p>Here we discuss averaging operators in 1D, 2D and 3D. In 1D we can
average between nodes and cell centers. In higher dimensions, we may need to
average between nodes, cell centers, faces and edges. For this example we
describe the averaging operator from faces to cell centers in 1D, 2D and 3D.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct uniform meshes in 1D, 2D and 3D</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mesh1D</span> <span class="o">=</span> <span class="n">TensorMesh</span><span class="p">([</span><span class="n">h</span><span class="p">],</span> <span class="n">x0</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="n">mesh2D</span> <span class="o">=</span> <span class="n">TensorMesh</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">x0</span><span class="o">=</span><span class="s1">&#39;CC&#39;</span><span class="p">)</span>
<span class="n">mesh3D</span> <span class="o">=</span> <span class="n">TensorMesh</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">x0</span><span class="o">=</span><span class="s1">&#39;CCC&#39;</span><span class="p">)</span>

<span class="c1"># Create averaging operators</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">mesh1D</span><span class="o">.</span><span class="n">aveF2CC</span>  <span class="c1"># Averages faces (nodes in 1D) to centers</span>
<span class="n">A2</span> <span class="o">=</span> <span class="n">mesh2D</span><span class="o">.</span><span class="n">aveF2CC</span>  <span class="c1"># Averages from x and y faces to centers</span>
<span class="n">A3</span> <span class="o">=</span> <span class="n">mesh3D</span><span class="o">.</span><span class="n">aveF2CC</span>  <span class="c1"># Averages from x, y and z faces to centers</span>

<span class="c1"># Plot sparse representation</span>
<span class="n">fig</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Faces to centers in 1D&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">A2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Faces to centers in 2D&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">A3</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Faces to centers in 3D&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Print some properties</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> For 1D mesh:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of cells:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh1D</span><span class="o">.</span><span class="n">nC</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of faces:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh1D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Dimensions of operator:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh1D</span><span class="o">.</span><span class="n">nC</span><span class="p">),</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh1D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of non-zero elements:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">A1</span><span class="o">.</span><span class="n">nnz</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For 2D mesh:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of cells:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh2D</span><span class="o">.</span><span class="n">nC</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of faces:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh2D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Dimensions of operator:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh2D</span><span class="o">.</span><span class="n">nC</span><span class="p">),</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh2D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of non-zero elements:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">A2</span><span class="o">.</span><span class="n">nnz</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For 3D mesh:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of cells:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh3D</span><span class="o">.</span><span class="n">nC</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of faces:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh3D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Dimensions of operator:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh3D</span><span class="o">.</span><span class="n">nC</span><span class="p">),</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mesh3D</span><span class="o">.</span><span class="n">nF</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;- Number of non-zero elements:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">A3</span><span class="o">.</span><span class="n">nnz</span><span class="p">))</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_1_averaging_002.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_1_averaging_002.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/travis/build/simpeg/discretize/tutorials/operators/1_averaging.py:118: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  fig.show()

 For 1D mesh:
- Number of cells: 10
- Number of faces: 11
- Dimensions of operator: 10 x 11
- Number of non-zero elements: 20

For 2D mesh:
- Number of cells: 100
- Number of faces: 220
- Dimensions of operator: 100 x 220
- Number of non-zero elements: 400

For 3D mesh:
- Number of cells: 1000
- Number of faces: 3300
- Dimensions of operator: 1000 x 3300
- Number of non-zero elements: 6000
</pre></div>
</div>
</div>
<div class="section" id="discontinuous-functions-and-the-transpose">
<h2>Discontinuous Functions and the Transpose<a class="headerlink" href="#discontinuous-functions-and-the-transpose" title="Permalink to this headline">¶</a></h2>
<p>Here we show the effects of applying averaging operators to discontinuous
functions. We will see that averaging smears the function at
discontinuities.</p>
<p>The transpose of an averaging operator is also an
averaging operator. For example, we can average from cell centers to faces
by taking the transpose of operator that averages from faces to cell centers.
Note that values on the boundaries are not accurate when applying the
transpose as an averaging operator. This is also true for staggered grids.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create mesh and obtain averaging operators</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">TensorMesh</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">h</span><span class="p">],</span> <span class="n">x0</span><span class="o">=</span><span class="s1">&#39;CC&#39;</span><span class="p">)</span>

<span class="n">A2</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aveCC2F</span>  <span class="c1"># cell centers to faces</span>
<span class="n">A3</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aveN2CC</span>  <span class="c1"># nodes to cell centers</span>
<span class="n">A4</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">aveF2CC</span>  <span class="c1"># faces to cell centers</span>

<span class="c1"># Create a variable on cell centers</span>
<span class="n">v</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nC</span><span class="p">)</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">gridCC</span>
<span class="n">v</span><span class="p">[(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">v</span><span class="p">[(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">10.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10.</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">50.</span>

<span class="n">fig</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="View documentation for matplotlib.pyplot.figure"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">plotImage</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Variable at cell centers&#39;</span><span class="p">)</span>

<span class="c1"># Apply cell centers to faces averaging</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">plotImage</span><span class="p">(</span><span class="n">A2</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">vType</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cell centers to faces&#39;</span><span class="p">)</span>

<span class="c1"># Use the transpose to go from cell centers to nodes</span>
<span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">plotImage</span><span class="p">(</span><span class="n">A3</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">vType</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cell centers to nodes using transpose&#39;</span><span class="p">)</span>

<span class="c1"># Use the transpose to go from cell centers to faces</span>
<span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">plotImage</span><span class="p">(</span><span class="n">A4</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">vType</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cell centers to faces using transpose&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_1_averaging_003.png" class="sphx-glr-single-img" src="../../_images/sphx_glr_1_averaging_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/home/travis/build/simpeg/discretize/tutorials/operators/1_averaging.py:189: UserWarning: Matplotlib is currently using agg, which is a non-GUI backend, so cannot show the figure.
  fig.show()
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.709 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-tutorials-operators-1-averaging-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/47908213f93355467d6449767dd38315/1_averaging.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">1_averaging.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" download="" href="../../_downloads/67d706bf1d620a4ff391489fdd50882d/1_averaging.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">1_averaging.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="2_differential.html" class="btn btn-neutral float-right" title="Differential Operators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Operators" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" width="60px"; style="float:right;height:3em;line-height:3em;padding:10px 0 0 1em;">
        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    2013-2019,
    <a href="http://simpeg.xyz">SimPEG Developers.</a><br />
    Except where noted, this work is licensed under a <br />
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        Creative Commons Attribution 4.0 International License
    </a>
</div>
<br>
<div>
Built with
    <a href="http://sphinx-doc.org/">Sphinx</a>
    using a
    <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by
    <a href="https://readthedocs.org">Read the Docs</a>.
 </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>