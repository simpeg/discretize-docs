


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>properties.base.base &mdash; discretize 0.4.6 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/logo-block.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
 

<meta name="description" content="Simulation and Parameter Estimation in Geophysics">
<meta name="author" content="SimPEG Developers">
<meta name="keywords" content="python, geophysics, inversion, electromagnetics, magnetotellurics, magnetics, gravity, DC, flow inverse problems, open source, finite volume">


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45185336-1', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> discretize
          

          
          </a>

          
            
            
              <div class="version">
                0.4.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../content/big_picture.html">Why discretize?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/additional_resources.html">Additional Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/mesh_overview.html">Overview of mesh types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tensor_mesh.html">Tensor meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/cylindrical_mesh.html">Cylindrical meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/finite_volume.html">Finite Volume</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../content/inner_products.html">Inner Products</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">
            
                Getting connected
            
            </span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://simpeg.xyz"><i class="fa fa-external-link-square fa-fw"></i> SimPEG</a></li>
            
                <li class="toctree-l1"><a href="http://slack.simpeg.xyz"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/simpeg/discretize"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">discretize</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>properties.base.base</li>
    
    

    <li class="wy-breadcrumbs-aside">
        
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for properties.base.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;base.py: HasProperties class and metaclass&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="n">itervalues</span><span class="p">,</span> <span class="n">PY2</span><span class="p">,</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">with_metaclass</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">basic</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">handlers</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">utils</span>

<span class="k">if</span> <span class="n">PY2</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">types</span> <span class="k">import</span> <span class="n">ClassType</span>                                                <span class="c1">#pylint: disable=no-name-in-module</span>
    <span class="n">CLASS_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">ClassType</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">CLASS_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">,)</span>

<span class="n">GENERIC_ERRORS</span> <span class="o">=</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PropertyMetaclass</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass to establish behavior of **HasProperties** classes</span>

<span class="sd">    On class construction:</span>

<span class="sd">    * Build Property dictionary from the class dictionary and the base</span>
<span class="sd">      classes&#39; Properties.</span>
<span class="sd">    * Build listener dictionaries from class dictionary and the base</span>
<span class="sd">      classes&#39; listeners.</span>
<span class="sd">    * Check Property names are not private.</span>
<span class="sd">    * Ensure the Property names referred to by</span>
<span class="sd">      :ref:`Renamed Properties &lt;renamed&gt;` and</span>
<span class="sd">      handlers are valid.</span>
<span class="sd">    * Build class docstring.</span>
<span class="sd">    * Construct default value dictionary, and check that any provided</span>
<span class="sd">      defaults are valid.</span>
<span class="sd">    * Add the class to the **HasProperties** :code:`_REGISTRY` or the</span>
<span class="sd">      closest parent class with a new registry defined</span>

<span class="sd">    On class instantiation:</span>

<span class="sd">    * Initialize private backend dictionary where Property values are stored.</span>
<span class="sd">    * Initialize private listener dictionary and set the listeners on the</span>
<span class="sd">      class instance.</span>
<span class="sd">    * Set all the default values on the class without firing change</span>
<span class="sd">      notifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span><span class="p">):</span>                                  <span class="c1">#pylint: disable=too-many-locals, too-many-branches, too-many-statements</span>

        <span class="c1"># Grab all the properties, observers, and validators</span>
        <span class="n">prop_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">classdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basic</span><span class="o">.</span><span class="n">GettableProperty</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">observer_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">classdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">handlers</span><span class="o">.</span><span class="n">Observer</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">validator_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">classdict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">handlers</span><span class="o">.</span><span class="n">ClassValidator</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Get pointers to all inherited properties, observers, and validators</span>
        <span class="n">_props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">_prop_observers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">_class_validators</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_props&#39;</span><span class="p">),</span>
                        <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_prop_observers&#39;</span><span class="p">),</span>
                        <span class="nb">hasattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_class_validators&#39;</span><span class="p">))):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">_props</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop_dict</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">_props</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">_prop_observers</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">observer_dict</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">_prop_observers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">_class_validators</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">validator_dict</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">classdict</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">_class_validators</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>

        <span class="c1"># Overwrite with this class&#39;s properties</span>
        <span class="n">_props</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">prop_dict</span><span class="p">)</span>
        <span class="n">_prop_observers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">observer_dict</span><span class="p">)</span>
        <span class="n">_class_validators</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">validator_dict</span><span class="p">)</span>

        <span class="c1"># Save these to the class</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;_props&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_props</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;_prop_observers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_prop_observers</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;_class_validators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_class_validators</span>

        <span class="c1"># Ensure prop names are valid and overwrite properties with @property</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">prop_dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">basic</span><span class="o">.</span><span class="n">Renamed</span><span class="p">)</span> <span class="ow">and</span> <span class="n">prop</span><span class="o">.</span><span class="n">new_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_props</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid new name for renamed property: &#39;</span>
                                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">new_name</span><span class="p">))</span>
            <span class="n">prop</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">classdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_property</span><span class="p">()</span>

        <span class="c1"># Ensure observed names are valid</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">observer_dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">everything</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">handler</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">_props</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_props</span><span class="p">[</span><span class="n">prop</span><span class="p">],</span> <span class="n">basic</span><span class="o">.</span><span class="n">Property</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Observed name must be a mutable &#39;</span>
                                <span class="s1">&#39;property: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span>

        <span class="c1"># Overwrite observers and validators with their function</span>
        <span class="n">observer_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">validator_dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">observer_dict</span><span class="p">):</span>
            <span class="n">classdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">func</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">key</span>

        <span class="c1"># Determine if private properties should be documented or just public</span>
        <span class="n">_doc_private</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">_doc_private</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_doc_private&#39;</span><span class="p">,</span> <span class="n">_doc_private</span><span class="p">)</span>
        <span class="n">_doc_private</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_doc_private&#39;</span><span class="p">,</span> <span class="n">_doc_private</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_doc_private</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;_doc_private must be a boolean&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_doc_private</span><span class="p">:</span>
            <span class="n">documented_props</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_props</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">documented_props</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">_props</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="c1"># Order the properties for the docs (default is alphabetical)</span>
        <span class="n">_doc_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">bases</span><span class="p">):</span>
            <span class="n">_doc_order</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;_doc_order&#39;</span><span class="p">,</span> <span class="n">_doc_order</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_doc_order</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">or</span>
                    <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_doc_order</span><span class="p">))</span> <span class="o">!=</span> <span class="n">documented_props</span>
            <span class="p">):</span>
                <span class="n">_doc_order</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">_doc_order</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;_doc_order&#39;</span><span class="p">,</span> <span class="n">_doc_order</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_doc_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_doc_order</span> <span class="o">=</span> <span class="n">documented_props</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_doc_order</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;_doc_order must be a list of property names&#39;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_doc_order</span><span class="p">))</span> <span class="o">!=</span> <span class="n">documented_props</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;_doc_order must be unspecified or contain ALL property names&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Sort props into required, optional, and immutable</span>
        <span class="n">doc_str</span> <span class="o">=</span> <span class="n">classdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__doc__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_doc_order</span>
               <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_doc_order</span>
               <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="n">imm</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_doc_order</span>
               <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;_&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">&#39;required&#39;</span><span class="p">)]</span>
        <span class="n">priv</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">_doc_order</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">]</span>

        <span class="c1"># Build the documentation based on above sorting</span>
        <span class="k">if</span> <span class="n">req</span><span class="p">:</span>
            <span class="n">doc_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">**Required Properties:**</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;* &#39;</span> <span class="o">+</span> <span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sphinx</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">req</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">opt</span><span class="p">:</span>
            <span class="n">doc_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">**Optional Properties:**</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;* &#39;</span> <span class="o">+</span> <span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sphinx</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">opt</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">imm</span><span class="p">:</span>
            <span class="n">doc_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">**Other Properties:**</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;* &#39;</span> <span class="o">+</span> <span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sphinx</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">imm</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">priv</span><span class="p">:</span>
            <span class="n">doc_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">**Private Properties:**</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;* &#39;</span> <span class="o">+</span> <span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sphinx</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">priv</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="n">classdict</span><span class="p">[</span><span class="s1">&#39;__doc__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">doc_str</span>

        <span class="c1"># Create the new class</span>
        <span class="n">newcls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">PropertyMetaclass</span><span class="p">,</span> <span class="n">mcs</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="n">mcs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">classdict</span>
        <span class="p">)</span>

        <span class="c1"># Update the class defaults to include inherited values</span>
        <span class="n">_defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">newcls</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">):</span>
            <span class="n">_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;_defaults&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">()))</span>

        <span class="c1"># Ensure defaults are valid and add them to the class</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">_defaults</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newcls</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;Default input &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a known property&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">newcls</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid default for property &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">newcls</span><span class="o">.</span><span class="n">_defaults</span> <span class="o">=</span> <span class="n">_defaults</span>

        <span class="c1"># Save the class in the registry</span>
        <span class="n">newcls</span><span class="o">.</span><span class="n">_REGISTRY</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newcls</span>

        <span class="k">return</span> <span class="n">newcls</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Here additional instance setup happens here before init is called</span>

<span class="sd">        This allows subclasses of :code:`HasProperties` to override</span>
<span class="sd">        the init method without worrying about breaking setup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_backend&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
        <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_listeners&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>

        <span class="c1"># Register the listeners</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_prop_observers</span><span class="p">):</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">_set_listener</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Set the GettableProperties from defaults - these are only set here</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_props</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">basic</span><span class="o">.</span><span class="n">Property</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">default</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">()</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_backend</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Set the other defaults without triggering change notifications</span>
        <span class="k">with</span> <span class="n">handlers</span><span class="o">.</span><span class="n">listeners_disabled</span><span class="p">():</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">HasProperties</span><span class="p">(</span><span class="n">with_metaclass</span><span class="p">(</span><span class="n">PropertyMetaclass</span><span class="p">,</span> <span class="nb">object</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Base class to enable :ref:`property` behavior</span>

<span class="sd">    Classes that inherit **HasProperties** need simply to declare the</span>
<span class="sd">    Properties they need. **HasProperties** will save these Properties as</span>
<span class="sd">    :code:`_props` on the class. Property values will be saved to</span>
<span class="sd">    :code:`_backend` on the instance.</span>

<span class="sd">    **HasProperties** classes also store a registry of all</span>
<span class="sd">    **HasProperties** classes in as :code:`_REGISTRY`. If a subclass</span>
<span class="sd">    re-declares :code:`_REGISTRY`, the subsequent subclasses will be saved</span>
<span class="sd">    to this new registry.</span>

<span class="sd">    The :class:`PropertyMetaclass &lt;properties.base.PropertyMetaclass&gt;`</span>
<span class="sd">    contains more information about what goes into **HasProperties**</span>
<span class="sd">    class construction and validation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">_REGISTRY</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Set the keyword arguments with change notifications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getting_validated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">prop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prop</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                        <span class="s2">&quot;Keyword input &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a known  property or &quot;</span>
                        <span class="s2">&quot;attribute of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">basic</span><span class="o">.</span><span class="n">DynamicProperty</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                        <span class="s2">&quot;Dynamic property &#39;</span><span class="si">{}</span><span class="s2">&#39; of </span><span class="si">{}</span><span class="s2"> cannot be set on &quot;</span>
                        <span class="s2">&quot;init&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">val_err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">+=</span> <span class="n">val_err</span><span class="o">.</span><span class="n">error_tuples</span>
                <span class="k">except</span> <span class="n">GENERIC_ERRORS</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="n">err</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">)</span>
                <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Initialization failed:&#39;</span><span class="p">]</span>
                <span class="n">msgs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">]</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">- &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msgs</span><span class="p">),</span>
                    <span class="n">_error_tuples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span>                               <span class="c1">#pylint: disable=raising-bad-type</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getting_validated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
        <span class="n">listeners</span> <span class="o">=</span> <span class="n">handlers</span><span class="o">.</span><span class="n">_get_listeners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">listener</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="o">.</span><span class="n">func</span><span class="p">)(</span><span class="n">change</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">listener</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span><span class="p">)</span>
        <span class="n">change</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="n">prev</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notify</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">prev</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span> <span class="ow">and</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span><span class="p">(</span>
                <span class="n">prev</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span> <span class="ow">or</span>
                <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="n">utils</span><span class="o">.</span><span class="n">undefined</span> <span class="ow">or</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">prev</span><span class="p">,</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="n">change</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="n">prev</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;observe_change&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_notify</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
        <span class="n">change</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="n">prev</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;observe_set&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notify</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Revert specified property to default value</span>

<span class="sd">        If no property is specified, all properties are returned to default.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">basic</span><span class="o">.</span><span class="n">Property</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_reset</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Input name &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a known &quot;</span>
                                 <span class="s2">&quot;property or attribute&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">basic</span><span class="o">.</span><span class="n">Property</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Cannot reset GettableProperty &quot;</span>
                                 <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defaults</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">default</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call all registered class validator methods</span>

<span class="sd">        These are all methods decorated with :code:`@properties.validator`.</span>
<span class="sd">        Validator methods are expected to raise a ValidationError if they</span>
<span class="sd">        fail.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_getting_validated&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getting_validated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_class_validators</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">func</span><span class="p">)()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">valid</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">valid</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                            <span class="s1">&#39;Validation failed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">val_err</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">+=</span> <span class="n">val_err</span><span class="o">.</span><span class="n">error_tuples</span>
                <span class="k">except</span> <span class="n">GENERIC_ERRORS</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="n">err</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_error_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">)</span>
                <span class="n">msgs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Validation failed:&#39;</span><span class="p">]</span>
                <span class="n">msgs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">message</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">]</span>
                <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">- &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msgs</span><span class="p">),</span>
                    <span class="n">_error_tuples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span>                               <span class="c1">#pylint: disable=raising-bad-type</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getting_validated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_non_validation_error</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@handlers</span><span class="o">.</span><span class="n">validator</span>
    <span class="k">def</span> <span class="nf">_validate_props</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assert that all the properties are valid on validate()&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid value for property </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">change</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">previous</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                                  <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_notify</span><span class="p">(</span><span class="n">change</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">prop</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">change</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">,</span> <span class="s1">&#39;invalid&#39;</span><span class="p">,</span>
                                                    <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prop</span><span class="o">.</span><span class="n">assert_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">,</span> <span class="s1">&#39;invalid&#39;</span><span class="p">,</span>
                                                <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">val_err</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_validation_error_tuples&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_validation_error_tuples</span> <span class="o">+=</span> <span class="n">val_err</span><span class="o">.</span><span class="n">error_tuples</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_error_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_tuples</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Method called when property validation fails</span>

<span class="sd">        This allows HasProperties classes to customize how the</span>
<span class="sd">        validation error is handled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_class</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_dynamic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Serializes a **HasProperties** instance to dictionary</span>

<span class="sd">        This uses the Property serializers to serialize all Property values</span>
<span class="sd">        to a JSON-compatible dictionary. Properties that are undefined are</span>
<span class="sd">        not included. If the **HasProperties** instance contains a reference</span>
<span class="sd">        to itself, a :code:`properties.SelfReferenceError` will be raised.</span>

<span class="sd">        **Parameters**:</span>

<span class="sd">        * **include_class** - If True (the default), the name of the class</span>
<span class="sd">          will also be saved to the serialized dictionary under key</span>
<span class="sd">          :code:`&#39;__class__&#39;`</span>
<span class="sd">        * **save_dynamic** - If True, dynamic properties are written to</span>
<span class="sd">          the serialized dict (default: False).</span>
<span class="sd">        * Any other keyword arguments will be passed through to the Property</span>
<span class="sd">          serializers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_getting_serialized&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">SelfReferenceError</span><span class="p">(</span><span class="s1">&#39;Object contains unserializable &#39;</span>
                                           <span class="s1">&#39;self reference&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getting_serialized</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s1">&#39;include_class&#39;</span><span class="p">:</span> <span class="n">include_class</span><span class="p">,</span>
                <span class="s1">&#39;save_dynamic&#39;</span><span class="p">:</span> <span class="n">save_dynamic</span>
            <span class="p">})</span>
            <span class="k">if</span> <span class="n">save_dynamic</span><span class="p">:</span>
                <span class="n">prop_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prop_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prop_source</span>
            <span class="p">)</span>
            <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">include_class</span><span class="p">:</span>
                <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;__class__&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">})</span>
            <span class="k">return</span> <span class="n">json_dict</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getting_serialized</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">trusted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>                   <span class="c1">#pylint: disable=too-many-locals</span>
                    <span class="n">assert_valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates **HasProperties** instance from serialized dictionary</span>

<span class="sd">        This uses the Property deserializers to deserialize all</span>
<span class="sd">        JSON-compatible dictionary values into their corresponding Property</span>
<span class="sd">        values on a new instance of a **HasProperties** class. Extra keys</span>
<span class="sd">        in the dictionary that do not correspond to Properties will be</span>
<span class="sd">        ignored.</span>

<span class="sd">        **Parameters**:</span>

<span class="sd">        * **value** - Dictionary to deserialize new instance from.</span>
<span class="sd">        * **trusted** - If True (and if the input dictionary has</span>
<span class="sd">          :code:`&#39;__class__&#39;` keyword and this class is in the registry), the</span>
<span class="sd">          new **HasProperties** class will come from the dictionary.</span>
<span class="sd">          If False (the default), only the **HasProperties** class this</span>
<span class="sd">          method is called on will be constructed.</span>
<span class="sd">        * **strict** - Requires :code:`&#39;__class__&#39;`, if present on the input</span>
<span class="sd">          dictionary, to match the deserialized instance&#39;s class. Also</span>
<span class="sd">          disallows unused properties in the input dictionary. Default</span>
<span class="sd">          is False.</span>
<span class="sd">        * **assert_valid** - Require deserialized instance to be valid.</span>
<span class="sd">          Default is False.</span>
<span class="sd">        * Any other keyword arguments will be passed through to the Property</span>
<span class="sd">          deserializers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;HasProperties class </span><span class="si">{}</span><span class="s1"> must deserialize from dictionary, &#39;</span>
                <span class="s1">&#39;not input of type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">output_cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_deserialize_class</span><span class="p">(</span>
            <span class="n">input_cls_name</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__class__&#39;</span><span class="p">),</span>
            <span class="n">trusted</span><span class="o">=</span><span class="n">trusted</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="n">strict</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_instance&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">output_cls</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Input _instance must be of class </span><span class="si">{}</span><span class="s1">, not </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">output_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">state</span><span class="p">,</span> <span class="n">unused</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">filter_props</span><span class="p">(</span><span class="n">output_cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">unused</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unused</span> <span class="ow">and</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Unused properties during deserialization: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unused</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;trusted&#39;</span><span class="p">:</span> <span class="n">trusted</span><span class="p">,</span> <span class="s1">&#39;strict&#39;</span><span class="p">:</span> <span class="n">strict</span><span class="p">})</span>
        <span class="n">newstate</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
            <span class="n">newstate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_cls</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mutable</span><span class="p">,</span> <span class="n">immutable</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">filter_props</span><span class="p">(</span><span class="n">output_cls</span><span class="p">,</span> <span class="n">newstate</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">handlers</span><span class="o">.</span><span class="n">listeners_disabled</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="n">output_cls</span><span class="p">(</span><span class="o">**</span><span class="n">mutable</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">mutable</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">immutable</span><span class="p">):</span>
            <span class="n">valid_val</span> <span class="o">=</span> <span class="n">output_cls</span><span class="o">.</span><span class="n">_props</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_backend</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">valid_val</span>
        <span class="k">if</span> <span class="n">assert_valid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">instance</span><span class="o">.</span><span class="n">validate</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">utils</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Deserialized instance is not valid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_deserialize_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">input_cls_name</span><span class="p">,</span> <span class="n">trusted</span><span class="p">,</span> <span class="n">strict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the HasProperties class to use for deserialization&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">input_cls_name</span> <span class="ow">or</span> <span class="n">input_cls_name</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span>
        <span class="k">if</span> <span class="n">trusted</span> <span class="ow">and</span> <span class="n">input_cls_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_REGISTRY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_REGISTRY</span><span class="p">[</span><span class="n">input_cls_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Class name </span><span class="si">{}</span><span class="s1"> from deserialization input dictionary does &#39;</span>
                <span class="s1">&#39;not match input class </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_cls_name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if two **HasProperties** instances are equivalent</span>

<span class="sd">        Equivalence is determined by checking if all Property values on</span>
<span class="sd">        two instances are equal, using :code:`Property.equal`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;HasProperties.equal has been deprecated in favor of &#39;</span>
             <span class="s1">&#39;properties.equal and will be removed in the next release&#39;</span><span class="p">,</span>
             <span class="ne">FutureWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">equal</span><span class="p">(</span><span class="n">value_a</span><span class="p">,</span> <span class="n">value_b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine if two **HasProperties** instances are equivalent</span>

<span class="sd">    Equivalence is determined by checking if (1) the two instances are</span>
<span class="sd">    the same class and (2) all Property values on two instances are</span>
<span class="sd">    equal, using :code:`Property.equal`. If the two values are the same</span>
<span class="sd">    HasProperties instance (eg. :code:`value_a is value_b`) this method</span>
<span class="sd">    returns True. Finally, if either value is not a HasProperties</span>
<span class="sd">    instance, equality is simply checked with ==.</span>

<span class="sd">    .. note::</span>

<span class="sd">        HasProperties objects with recursive self-references will not</span>
<span class="sd">        evaluate to equal, even if their property values and structure</span>
<span class="sd">        are equivalent.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_a</span><span class="p">,</span> <span class="n">HasProperties</span><span class="p">)</span> <span class="ow">or</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value_b</span><span class="p">,</span> <span class="n">HasProperties</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">value_a</span> <span class="o">==</span> <span class="n">value_b</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value_a</span><span class="p">,</span> <span class="s1">&#39;_testing_equality&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">value_a</span><span class="o">.</span><span class="n">_testing_equality</span> <span class="o">=</span> <span class="kc">True</span>                                           <span class="c1">#pylint: disable=protected-access</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value_a</span> <span class="ow">is</span> <span class="n">value_b</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">value_a</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">value_b</span><span class="o">.</span><span class="vm">__class__</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">itervalues</span><span class="p">(</span><span class="n">value_a</span><span class="o">.</span><span class="n">_props</span><span class="p">):</span>
            <span class="n">prop_a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value_a</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">prop_b</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value_b</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prop_a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">prop_b</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">prop_a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">prop_b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">prop_a</span><span class="p">,</span> <span class="n">prop_b</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">value_a</span><span class="o">.</span><span class="n">_testing_equality</span> <span class="o">=</span> <span class="kc">False</span>                                      <span class="c1">#pylint: disable=protected-access</span>


<span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a copy of a **HasProperties** instance</span>

<span class="sd">    A copy is produced by serializing the HasProperties instance then</span>
<span class="sd">    deserializing it to a new instance. Therefore, if any properties</span>
<span class="sd">    cannot be serialized/deserialized, :code:`copy` will fail. Any</span>
<span class="sd">    keyword arguments will be passed through to both :code:`serialize`</span>
<span class="sd">    and :code:`deserialize`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">HasProperties</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;properties.copy may only be used to copy&#39;</span>
                         <span class="s1">&#39;HasProperties instances&#39;</span><span class="p">)</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;include_class&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_class&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)})</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;trusted&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trusted&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<div role="contentinfo">
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" width="60px"; style="float:right;height:3em;line-height:3em;padding:10px 0 0 1em;">
        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    2013-2019,
    <a href="http://simpeg.xyz">SimPEG Developers.</a><br />
    Except where noted, this work is licensed under a <br />
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        Creative Commons Attribution 4.0 International License
    </a>
</div>
<br>
<div>
Built with
    <a href="http://sphinx-doc.org/">Sphinx</a>
    using a
    <a href="https://github.com/snide/sphinx_rtd_theme">theme</a>
    provided by
    <a href="https://readthedocs.org">Read the Docs</a>.
 </div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>